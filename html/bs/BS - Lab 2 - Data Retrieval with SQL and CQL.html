<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="mobile-web-app-capable" content="yes">
    <title>
        BS - Lab 2 - Data Retrieval with SQL and CQL - CodiMD
    </title>
    <link rel="icon" type="image/png" href="http://localhost:3000/favicon.png">
    <link rel="apple-touch-icon" href="http://localhost:3000/apple-touch-icon.png">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.0/css/bootstrap.min.css" integrity="sha256-H0KfTigpUV+0/5tn2HXC0CPwhhDhWgSawJdnFd0CGCo=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fork-awesome/1.1.3/css/fork-awesome.min.css" integrity="sha256-ZhApazu+kejqTYhMF+1DzNKjIzP7KXu6AzyXcC1gMus=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ionicons/2.0.1/css/ionicons.min.css" integrity="sha256-3iu9jgsy9TpTwXKb7bNQzqWekRX7pPK+2OLj3R922fo=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.5.1/themes/prism.min.css" integrity="sha256-vtR0hSWRc3Tb26iuN2oZHt3KRUomwTufNIf5/4oeCyg=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github-gist.min.css" integrity="sha256-tAflq+ymku3Khs+I/WcAneIlafYgDiOQ9stIHH985Wo=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@hackmd/emojify.js@2.1.0/dist/css/basic/emojify.min.css" integrity="sha256-UOrvMOsSDSrW6szVLe8ZDZezBxh5IoIfgTwdNDgTjiU=" crossorigin="anonymous" />
    <style>
        @import url(https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,400italic,600,600italic,300italic,300|Source+Serif+Pro|Source+Code+Pro:400,300,500&subset=latin,latin-ext);.markdown-body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol;font-size:16px;line-height:1.5;word-wrap:break-word}.markdown-body:after,.markdown-body:before{display:table;content:""}.markdown-body:after{clear:both}.markdown-body>:first-child{margin-top:0!important}.markdown-body>:last-child{margin-bottom:0!important}.markdown-body a:not([href]){color:inherit;text-decoration:none}.markdown-body .absent{color:#c00}.markdown-body .anchor{float:left;padding-right:4px;margin-left:-20px;line-height:1}.markdown-body .anchor:focus{outline:none}.markdown-body blockquote,.markdown-body dl,.markdown-body ol,.markdown-body p,.markdown-body pre,.markdown-body table,.markdown-body ul{margin-top:0;margin-bottom:16px}.markdown-body hr{height:.25em;padding:0;margin:24px 0;background-color:#e7e7e7;border:0}.markdown-body blockquote{padding:0 1em;color:#777;border-left:.25em solid #ddd}.night .markdown-body blockquote{color:#bcbcbc}.markdown-body blockquote>:first-child{margin-top:0}.markdown-body blockquote>:last-child{margin-bottom:0}.markdown-body .loweralpha{list-style-type:lower-alpha}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:24px;margin-bottom:16px;font-weight:600;line-height:1.25}.night .markdown-body h1,.night .markdown-body h2,.night .markdown-body h3,.night .markdown-body h4,.night .markdown-body h5,.night .markdown-body h6{color:#ddd}.markdown-body h1 .fa-link,.markdown-body h2 .fa-link,.markdown-body h3 .fa-link,.markdown-body h4 .fa-link,.markdown-body h5 .fa-link,.markdown-body h6 .fa-link{color:#000;vertical-align:middle;visibility:hidden;font-size:16px}.night .markdown-body h1 .fa-link,.night .markdown-body h2 .fa-link,.night .markdown-body h3 .fa-link,.night .markdown-body h4 .fa-link,.night .markdown-body h5 .fa-link,.night .markdown-body h6 .fa-link{color:#fff}.markdown-body h1:hover .anchor,.markdown-body h2:hover .anchor,.markdown-body h3:hover .anchor,.markdown-body h4:hover .anchor,.markdown-body h5:hover .anchor,.markdown-body h6:hover .anchor{text-decoration:none}.markdown-body h1:hover .anchor .fa-link,.markdown-body h2:hover .anchor .fa-link,.markdown-body h3:hover .anchor .fa-link,.markdown-body h4:hover .anchor .fa-link,.markdown-body h5:hover .anchor .fa-link,.markdown-body h6:hover .anchor .fa-link{visibility:visible}.markdown-body h1 code,.markdown-body h1 tt,.markdown-body h2 code,.markdown-body h2 tt,.markdown-body h3 code,.markdown-body h3 tt,.markdown-body h4 code,.markdown-body h4 tt,.markdown-body h5 code,.markdown-body h5 tt,.markdown-body h6 code,.markdown-body h6 tt{font-size:inherit}.markdown-body h1{font-size:2em}.markdown-body h1,.markdown-body h2{padding-bottom:.3em;border-bottom:1px solid #eee}.markdown-body h2{font-size:1.5em}.markdown-body h3{font-size:1.25em}.markdown-body h4{font-size:1em}.markdown-body h5{font-size:.875em}.markdown-body h6{font-size:.85em;color:#777}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol.no-list,.markdown-body ul.no-list{padding:0;list-style-type:none}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:0;margin-bottom:0}.markdown-body li>p{margin-top:16px}.markdown-body li+li{margin-top:.25em}.markdown-body dl{padding:0}.markdown-body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:700}.markdown-body dl dd{padding:0 16px;margin-bottom:16px}.markdown-body table{display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}.markdown-body table th{font-weight:700}.markdown-body table td,.markdown-body table th{padding:6px 13px;border:1px solid #ddd}.markdown-body table tr{background-color:#fff;border-top:1px solid #ccc}.night .markdown-body table tr{background-color:#5f5f5f}.markdown-body table tr:nth-child(2n){background-color:#f8f8f8}.night .markdown-body table tr:nth-child(2n){background-color:#4f4f4f}.markdown-body img{max-width:100%;box-sizing:content-box;background-color:#fff}.markdown-body img[align=right]{padding-left:20px}.markdown-body img[align=left]{padding-right:20px}.markdown-body .emoji{max-width:none;vertical-align:text-top;background-color:transparent}.markdown-body span.frame{display:block;overflow:hidden}.markdown-body span.frame>span{display:block;float:left;width:auto;padding:7px;margin:13px 0 0;overflow:hidden;border:1px solid #ddd}.markdown-body span.frame span img{display:block;float:left}.markdown-body span.frame span span{display:block;padding:5px 0 0;clear:both;color:#333}.markdown-body span.align-center{display:block;overflow:hidden;clear:both}.markdown-body span.align-center>span{display:block;margin:13px auto 0;overflow:hidden;text-align:center}.markdown-body span.align-center span img{margin:0 auto;text-align:center}.markdown-body span.align-right{display:block;overflow:hidden;clear:both}.markdown-body span.align-right>span{display:block;margin:13px 0 0;overflow:hidden;text-align:right}.markdown-body span.align-right span img{margin:0;text-align:right}.markdown-body span.float-left{display:block;float:left;margin-right:13px;overflow:hidden}.markdown-body span.float-left span{margin:13px 0 0}.markdown-body span.float-right{display:block;float:right;margin-left:13px;overflow:hidden}.markdown-body span.float-right>span{display:block;margin:13px auto 0;overflow:hidden;text-align:right}.markdown-body code,.markdown-body tt{padding:.2em 0;margin:0;font-size:85%;background-color:rgba(0,0,0,.04);border-radius:3px}.night .markdown-body code,.night .markdown-body tt{color:#eee;background-color:hsla(0,0%,90.2%,.36)}.markdown-body code:after,.markdown-body code:before,.markdown-body tt:after,.markdown-body tt:before{letter-spacing:-.2em;content:"\A0"}.markdown-body code br,.markdown-body tt br{display:none}.markdown-body del code{text-decoration:inherit}.markdown-body pre{word-wrap:normal}.markdown-body pre>code{padding:0;margin:0;font-size:100%;word-break:normal;white-space:pre;background:transparent;border:0}.markdown-body .highlight{margin-bottom:16px}.markdown-body .highlight pre{margin-bottom:0;word-break:normal}.markdown-body .highlight pre,.markdown-body pre{padding:16px;overflow:auto;font-size:85%;line-height:1.45;background-color:#f7f7f7;border-radius:3px}.markdown-body pre code,.markdown-body pre tt{display:inline;max-width:auto;padding:0;margin:0;overflow:visible;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}.markdown-body pre code:after,.markdown-body pre code:before,.markdown-body pre tt:after,.markdown-body pre tt:before{content:normal}.markdown-body .csv-data td,.markdown-body .csv-data th{padding:5px;overflow:hidden;font-size:12px;line-height:1;text-align:left;white-space:nowrap}.markdown-body .csv-data .blob-line-num{padding:10px 8px 9px;text-align:right;background:#fff;border:0}.markdown-body .csv-data tr{border-top:0}.markdown-body .csv-data th{font-weight:700;background:#f8f8f8;border-top:0}.markdown-body kbd{display:inline-block;padding:3px 5px;font-size:11px;line-height:10px;color:#555;vertical-align:middle;background-color:#fcfcfc;border:1px solid;border-color:#ccc #ccc #bbb;border-radius:3px;box-shadow:inset 0 -1px 0 #bbb}.news .alert .markdown-body blockquote{padding:0 0 0 40px;border:0}.activity-tab .news .alert .commits,.activity-tab .news .markdown-body blockquote{padding-left:0}.task-list-item{list-style-type:none}.task-list-item label{font-weight:400}.task-list-item.enabled label{cursor:pointer}.task-list-item+.task-list-item{margin-top:3px}.task-list-item-checkbox{float:left;margin:.31em 0 .2em -1.3em!important;vertical-align:middle;cursor:default!important}.markdown-body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol;padding-top:40px;padding-bottom:40px;max-width:758px;overflow:visible!important}.markdown-body pre{border:inherit!important}.night .markdown-body pre{filter:invert(100%)}.markdown-body code{color:inherit!important}.markdown-body pre code .wrapper{display:-webkit-inline-flex;display:-moz-inline-flex;display:-ms-inline-flex;display:-o-inline-flex;display:inline-flex}.markdown-body pre code .gutter{float:left;overflow:hidden;-webkit-user-select:none;user-select:none}.markdown-body pre code .gutter.linenumber{text-align:right;position:relative;display:inline-block;cursor:default;z-index:4;padding:0 8px 0 0;min-width:20px;box-sizing:content-box;color:#afafaf!important;border-right:3px solid #6ce26c!important}.markdown-body pre code .gutter.linenumber>span:before{content:attr(data-linenumber)}.markdown-body pre code .code{float:left;margin:0 0 0 16px}.markdown-body .gist .line-numbers{border-left:none;border-top:none;border-bottom:none}.markdown-body .gist .line-data{border:none}.markdown-body .gist table{border-spacing:0;border-collapse:inherit!important}.night .markdown-body .gist table tr:nth-child(2n){background-color:#ddd}.markdown-body code[data-gist-id]{background:none;padding:0;filter:invert(100%)}.markdown-body code[data-gist-id]:after,.markdown-body code[data-gist-id]:before{content:""}.markdown-body code[data-gist-id] .blob-num{border:unset}.markdown-body code[data-gist-id] table{overflow:unset;margin-bottom:unset}.markdown-body code[data-gist-id] table tr{background:unset}.markdown-body[dir=rtl] pre{direction:ltr}.markdown-body[dir=rtl] code{direction:ltr;unicode-bidi:embed}.markdown-body .alert>p{margin-bottom:0}.markdown-body pre.abc,.markdown-body pre.flow-chart,.markdown-body pre.geo,.markdown-body pre.graphviz,.markdown-body pre.mermaid,.markdown-body pre.sequence-diagram,.markdown-body pre.vega{text-align:center;background-color:inherit;border-radius:0;white-space:inherit}.night .markdown-body pre.graphviz .graph>polygon{fill:#333}.night .markdown-body pre.mermaid .sectionTitle,.night .markdown-body pre.mermaid .titleText,.night .markdown-body pre.mermaid text{fill:#fff}.markdown-body pre.abc>code,.markdown-body pre.flow-chart>code,.markdown-body pre.graphviz>code,.markdown-body pre.mermaid>code,.markdown-body pre.sequence-diagram>code,.markdown-body pre.vega>code{text-align:left}.markdown-body pre.abc>svg,.markdown-body pre.flow-chart>svg,.markdown-body pre.graphviz>svg,.markdown-body pre.mermaid>svg,.markdown-body pre.sequence-diagram>svg,.markdown-body pre.vega>svg{max-width:100%;height:100%}.night .markdown-body .abc path{fill:#eee}.night .markdown-body .abc path.note_selected{fill:##4DD0E1}.night tspan{fill:#fefefe}.night pre rect{fill:transparent}.night pre.flow-chart path,.night pre.flow-chart rect{stroke:#fff}.markdown-body pre>code.wrap{white-space:pre-wrap;white-space:-moz-pre-wrap;white-space:-pre-wrap;white-space:-o-pre-wrap;word-wrap:break-word}.markdown-body .alert>p,.markdown-body .alert>ul{margin-bottom:0}.markdown-body summary{display:list-item}.markdown-body summary:focus{outline:none}.markdown-body details summary{cursor:pointer}.markdown-body details:not([open])>:not(summary){display:none}.markdown-body figure{margin:1em 40px}.markdown-body img{background-color:transparent}.vimeo,.youtube{cursor:pointer;display:table;text-align:center;background-position:50%;background-repeat:no-repeat;background-size:contain;background-color:#000;overflow:hidden}.vimeo,.youtube{position:relative;width:100%}.youtube{padding-bottom:56.25%}.vimeo img{width:100%;object-fit:contain;z-index:0}.youtube img{object-fit:cover;z-index:0}.vimeo iframe,.youtube iframe,.youtube img{width:100%;height:100%;position:absolute;top:0;left:0}.vimeo iframe,.youtube iframe{vertical-align:middle;z-index:1}.vimeo .icon,.youtube .icon{position:absolute;height:auto;width:auto;top:50%;left:50%;transform:translate(-50%,-50%);color:#fff;opacity:.3;-webkit-transition:opacity .2s;transition:opacity .2s;z-index:0}.vimeo:hover .icon,.youtube:hover .icon{opacity:.6;-webkit-transition:opacity .2s;transition:opacity .2s}.slideshare .inner,.speakerdeck .inner{position:relative;width:100%}.slideshare .inner iframe,.speakerdeck .inner iframe{position:absolute;top:0;bottom:0;left:0;right:0;width:100%;height:100%}.geo-map{width:100%;height:250px}.markmap-container{height:300px}.markmap-container>svg{width:100%;height:100%}.MJX_Assistive_MathML{display:none}.ui-infobar{position:relative;z-index:2;max-width:758px;margin-top:25px;margin-bottom:-25px;color:#777}.toc .invisable-node{list-style-type:none}.ui-toc{position:fixed;bottom:20px;z-index:10000}.ui-toc-label{opacity:.9;background-color:#ccc;border:none}.ui-toc-label,.ui-toc .open .ui-toc-label{-webkit-transition:opacity .2s;transition:opacity .2s}.ui-toc .open .ui-toc-label{opacity:1;color:#5f5f5f}.ui-toc-label:focus{opacity:1;background-color:#ccc;color:#000}.ui-toc-label:hover{opacity:1;background-color:#ccc;-webkit-transition:opacity .2s;transition:opacity .2s}.ui-toc-dropdown{margin-top:23px;margin-bottom:20px;padding-left:10px;padding-right:10px;max-width:45vw;width:25vw;max-height:70vh;overflow:auto;text-align:inherit}.ui-toc-dropdown>.toc{max-height:calc(70vh - 100px);overflow:auto}.ui-toc-dropdown[dir=rtl] .nav{padding-right:0;letter-spacing:.0029em}.ui-toc-dropdown a{overflow:hidden;text-overflow:ellipsis;white-space:pre}.ui-toc-dropdown .nav>li>a{display:block;padding:4px 20px;font-size:13px;font-weight:500;color:#767676}.ui-toc-dropdown .nav>li:first-child:last-child>ul,.ui-toc-dropdown .toc.expand ul{display:block}.ui-toc-dropdown .nav>li>a:focus,.ui-toc-dropdown .nav>li>a:hover{padding-left:19px;color:#000;text-decoration:none;background-color:transparent;border-left:1px solid #000}.night .ui-toc-dropdown .nav>li>a:focus,.night .ui-toc-dropdown .nav>li>a:hover{color:#fff;border-left-color:#fff}.ui-toc-dropdown[dir=rtl] .nav>li>a:focus,.ui-toc-dropdown[dir=rtl] .nav>li>a:hover{padding-right:19px;border-left:none;border-right:1px solid #000}.ui-toc-dropdown .nav>.active:focus>a,.ui-toc-dropdown .nav>.active:hover>a,.ui-toc-dropdown .nav>.active>a{padding-left:18px;font-weight:700;color:#000;background-color:transparent;border-left:2px solid #000}.night .ui-toc-dropdown .nav>.active:focus>a,.night .ui-toc-dropdown .nav>.active:hover>a,.night .ui-toc-dropdown .nav>.active>a{color:#fff;border-left:2px solid #fff}.ui-toc-dropdown[dir=rtl] .nav>.active:focus>a,.ui-toc-dropdown[dir=rtl] .nav>.active:hover>a,.ui-toc-dropdown[dir=rtl] .nav>.active>a{padding-right:18px;border-left:none;border-right:2px solid #000}.ui-toc-dropdown .nav .nav{display:none;padding-bottom:10px}.ui-toc-dropdown .nav>.active>ul{display:block}.ui-toc-dropdown .nav .nav>li>a{padding-top:1px;padding-bottom:1px;padding-left:30px;font-size:12px;font-weight:400}.night .ui-toc-dropdown .nav>li>a{color:#aaa}.ui-toc-dropdown[dir=rtl] .nav .nav>li>a{padding-right:30px}.ui-toc-dropdown .nav .nav>li>ul>li>a{padding-top:1px;padding-bottom:1px;padding-left:40px;font-size:12px;font-weight:400}.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>a{padding-right:40px}.ui-toc-dropdown .nav .nav>li>ul>li>ul>li>a{padding-top:1px;padding-bottom:1px;padding-left:50px;font-size:12px;font-weight:400}.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>ul>li>a{padding-right:50px}.ui-toc-dropdown .nav .nav>li>ul>li>ul>li>ul>li>a{padding-top:1px;padding-bottom:1px;padding-left:60px;font-size:12px;font-weight:400}.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>ul>li>ul>li>a{padding-right:60px}.ui-toc-dropdown .nav .nav>li>a:focus,.ui-toc-dropdown .nav .nav>li>a:hover{padding-left:29px}.ui-toc-dropdown[dir=rtl] .nav .nav>li>a:focus,.ui-toc-dropdown[dir=rtl] .nav .nav>li>a:hover{padding-right:29px}.ui-toc-dropdown .nav .nav>li>ul>li>a:focus,.ui-toc-dropdown .nav .nav>li>ul>li>a:hover{padding-left:39px}.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>a:focus,.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>a:hover{padding-right:39px}.ui-toc-dropdown .nav .nav>li>ul>li>ul>li>a:focus,.ui-toc-dropdown .nav .nav>li>ul>li>ul>li>a:hover{padding-left:49px}.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>ul>li>a:focus,.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>ul>li>a:hover{padding-right:49px}.ui-toc-dropdown .nav .nav>li>ul>li>ul>li>ul>li>a:focus,.ui-toc-dropdown .nav .nav>li>ul>li>ul>li>ul>li>a:hover{padding-left:59px}.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>ul>li>ul>li>a:focus,.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>ul>li>ul>li>a:hover{padding-right:59px}.ui-toc-dropdown .nav .nav>.active:focus>a,.ui-toc-dropdown .nav .nav>.active:hover>a,.ui-toc-dropdown .nav .nav>.active>a{padding-left:28px;font-weight:500}.ui-toc-dropdown[dir=rtl] .nav .nav>.active:focus>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active:hover>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active>a{padding-right:28px}.ui-toc-dropdown .nav .nav>.active>.nav>.active:focus>a,.ui-toc-dropdown .nav .nav>.active>.nav>.active:hover>a,.ui-toc-dropdown .nav .nav>.active>.nav>.active>a{padding-left:38px;font-weight:500}.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.nav>.active:focus>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.nav>.active:hover>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.nav>.active>a{padding-right:38px}.ui-toc-dropdown .nav .nav>.active>.nav>.active>.nav>.active:focus>a,.ui-toc-dropdown .nav .nav>.active>.nav>.active>.nav>.active:hover>a,.ui-toc-dropdown .nav .nav>.active>.nav>.active>.nav>.active>a{padding-left:48px;font-weight:500}.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.active>.nav>.nav>.active>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.nav>.active>.nav>.active:focus>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.nav>.active>.nav>.active:hover>a{padding-right:48px}.ui-toc-dropdown .nav .nav>.active>.nav>.active>.nav>.active>.nav>.active:focus>a,.ui-toc-dropdown .nav .nav>.active>.nav>.active>.nav>.active>.nav>.active:hover>a,.ui-toc-dropdown .nav .nav>.active>.nav>.active>.nav>.active>.nav>.active>a{padding-left:58px;font-weight:500}.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.active>.nav>.nav>.active>.nav>.active>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.nav>.active>.nav>.active>.nav>.active:focus>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.nav>.active>.nav>.active>.nav>.active:hover>a{padding-right:58px}.markdown-body[lang^=ja]{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Helvetica,Arial,Hiragino Kaku Gothic Pro,"\30D2\30E9\30AE\30CE\89D2\30B4   Pro W3",Osaka,Meiryo,"\30E1\30A4\30EA\30AA",MS Gothic,"\FF2D\FF33   \30B4\30B7\30C3\30AF",sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}.ui-toc-dropdown[lang^=ja]{font-family:Source Sans Pro,Helvetica,Arial,Meiryo UI,MS PGothic,"\FF2D\FF33   \FF30\30B4\30B7\30C3\30AF",sans-serif}.markdown-body[lang=zh-tw]{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Helvetica,Arial,PingFang TC,Microsoft JhengHei,"\5FAE\8EDF\6B63\9ED1",sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}.ui-toc-dropdown[lang=zh-tw]{font-family:Source Sans Pro,Helvetica,Arial,Microsoft JhengHei UI,"\5FAE\8EDF\6B63\9ED1UI",sans-serif}.markdown-body[lang=zh-cn]{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Helvetica,Arial,PingFang SC,Microsoft YaHei,"\5FAE\8F6F\96C5\9ED1",sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}.ui-toc-dropdown[lang=zh-cn]{font-family:Source Sans Pro,Helvetica,Arial,Microsoft YaHei UI,"\5FAE\8F6F\96C5\9ED1UI",sans-serif}.ui-affix-toc{position:fixed;top:0;max-width:15vw;max-height:70vh;overflow:auto}.back-to-top,.expand-toggle,.go-to-bottom{display:block;padding:4px 10px;margin-top:10px;margin-left:10px;font-size:12px;font-weight:500;color:rgba(0,0,0,.85)}.back-to-top:focus,.back-to-top:hover,.expand-toggle:focus,.expand-toggle:hover,.go-to-bottom:focus,.go-to-bottom:hover{color:#563d7c;text-decoration:none}.back-to-top,.go-to-bottom{margin-top:0}.ui-user-icon{width:20px;height:20px;display:block;border-radius:3px;margin-top:2px;margin-bottom:2px;margin-right:5px;background-position:50%;background-repeat:no-repeat;background-size:contain}.ui-user-icon.small{width:18px;height:18px;display:inline-block;vertical-align:middle;margin:0 0 .2em}small span{line-height:22px}small .dropdown{display:inline-block}small .dropdown a:focus,small .dropdown a:hover{text-decoration:none}.unselectable{-moz-user-select:none;-khtml-user-select:none;-webkit-user-select:none;-o-user-select:none;user-select:none}.night .navbar{background:#333;border-bottom-color:#333;color:#eee}.night .navbar a{color:#eee}@media print{blockquote,div,img,pre,table{page-break-inside:avoid!important}a[href]:after{font-size:12px!important}}.markdown-body.slides{position:relative;z-index:1;color:#222}.markdown-body.slides:before{content:"";display:block;position:absolute;top:0;left:0;right:0;bottom:0;z-index:-1;background-color:currentColor;box-shadow:0 0 0 50vw}.markdown-body.slides section[data-markdown]{position:relative;margin-bottom:1.5em;background-color:#fff;text-align:center}.markdown-body.slides section[data-markdown] code{text-align:left}.markdown-body.slides section[data-markdown]:before{content:"";display:block;padding-bottom:56.23%}.markdown-body.slides section[data-markdown]>div:first-child{position:absolute;top:50%;left:1em;right:1em;transform:translateY(-50%);max-height:100%;overflow:hidden}.markdown-body.slides section[data-markdown]>ul{display:inline-block}.markdown-body.slides>section>section+section:after{content:"";position:absolute;top:-1.5em;right:1em;height:1.5em;border:3px solid #777}body{font-smoothing:subpixel-antialiased!important;-webkit-font-smoothing:subpixel-antialiased!important;-moz-osx-font-smoothing:auto!important;text-shadow:0 0 1em transparent,1px 1px 1.2px rgba(0,0,0,.004);-webkit-overflow-scrolling:touch;font-family:Source Sans Pro,Helvetica,Arial,sans-serif;letter-spacing:.025em}.focus,:focus{outline:none!important}::-moz-focus-inner{border:0!important}body.modal-open{overflow-y:auto;padding-right:0!important}
    </style>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    	<script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js" integrity="sha256-3Jy/GbSLrg0o9y5Z5n1uw0qxZECH7C6OQpVBgNFYa0g=" crossorigin="anonymous"></script>
    	<script src="https://cdnjs.cloudflare.com/ajax/libs/respond.js/1.4.2/respond.min.js" integrity="sha256-g6iAfvZp+nDQ2TdTR/VVKJf3bGro4ub5fvWSWVRi2NE=" crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/es5-shim/4.5.9/es5-shim.min.js" integrity="sha256-8E4Is26QH0bD52WoQpcB+R/tcWQtpzlCojrybUd7Mxo=" crossorigin="anonymous"></script>
    <![endif]-->
</head>

<body>
    <div id="doc" class="markdown-body container-fluid" lang="en"><h1 id="Lab-2---Data-Retrieval-with-SQL-and-CQL"><a class="anchor hidden-xs" href="#Lab-2---Data-Retrieval-with-SQL-and-CQL" title="Lab-2---Data-Retrieval-with-SQL-and-CQL"><i class="fa fa-link"></i></a>Lab 2 - Data Retrieval with SQL and CQL</h1><p><strong>Course:</strong> Big Data - IU S25<br>
<strong>Author:</strong> Firas Jolha</p><h1 id="Dataset"><a class="anchor hidden-xs" href="#Dataset" title="Dataset"><i class="fa fa-link"></i></a>Dataset</h1><ul>
<li><a href="https://disk.yandex.ru/d/HlBEEgUJmkD6Xg" target="_blank" rel="noopener">Users and Posts</a></li>
</ul><h1 id="Agenda"><a class="anchor hidden-xs" href="#Agenda" title="Agenda"><i class="fa fa-link"></i></a>Agenda</h1><p></p><div class="toc"><ul>
<li><a href="#Lab-2---Data-Retrieval-with-SQL-and-CQL" title="Lab 2 - Data Retrieval with SQL and CQL">Lab 2 - Data Retrieval with SQL and CQL</a></li>
<li><a href="#Dataset" title="Dataset">Dataset</a></li>
<li><a href="#Agenda" title="Agenda">Agenda</a></li>
<li><a href="#Prerequisites" title="Prerequisites">Prerequisites</a></li>
<li><a href="#Objectives" title="Objectives">Objectives</a></li>
<li><a href="#Introduction" title="Introduction">Introduction</a></li>
<li><a href="#Dataset-Descripion" title="Dataset Descripion">Dataset Descripion</a></li>
<li><a href="#Access-PostgreSQL-server" title="Access PostgreSQL server">Access PostgreSQL server</a></li>
<li><a href="#PostgreSQL-Meta-commands" title="PostgreSQL Meta-commands">PostgreSQL Meta-commands</a></li>
<li><a href="#Build-the-Database" title="Build the Database">Build the Database</a><ul>
<li><a href="#Fix-Friends-table" title="Fix Friends table">Fix Friends table</a></li>
</ul>
</li>
<li><a href="#Data-Retrieval-using-SQL" title="Data Retrieval using SQL">Data Retrieval using SQL</a><ul>
<li><a href="#Data-Retrieval-from-a-single-table" title="Data Retrieval from a single table">Data Retrieval from a single table</a></li>
<li><a href="#Data-Retrieval-from-multiple-tables-Joining-tables" title="Data Retrieval from multiple tables (Joining tables)">Data Retrieval from multiple tables (Joining tables)</a></li>
<li><a href="#Aggregation-and-grouping" title="Aggregation and grouping">Aggregation and grouping</a></li>
<li><a href="#Citus-Data" title="Citus Data">Citus Data</a></li>
</ul>
</li>
<li><a href="#Apache-Cassandra" title="Apache Cassandra">Apache Cassandra</a><ul>
<li><a href="#Installing-Cassandra" title="Installing Cassandra">Installing Cassandra</a><ul>
<li><a href="#Single-node-Cassandra-server-installation" title="Single-node Cassandra server installation">Single-node Cassandra server installation</a></li>
<li><a href="#Multi-node-Cassandra-cluster" title="Multi-node Cassandra cluster">Multi-node Cassandra cluster</a></li>
</ul>
</li>
<li><a href="#Cassandra-data-model" title="Cassandra data model">Cassandra data model</a></li>
<li><a href="#CQL" title="CQL">CQL</a></li>
<li><a href="#CQLSH" title="CQLSH">CQLSH</a><ul>
<li><a href="#Some-cqlsh-commands" title="Some cqlsh commands">Some cqlsh commands</a></li>
<li><a href="#Some-CRUD-operations" title="Some CRUD operations">Some CRUD operations</a></li>
<li><a href="#Collections-in-CQL" title="Collections in CQL">Collections in CQL</a></li>
<li><a href="#Conditional-queries" title="Conditional queries">Conditional queries</a></li>
<li><a href="#Clustering-columns" title="Clustering columns">Clustering columns</a></li>
<li><a href="#Group-by-clause" title="Group by clause">Group by clause</a></li>
</ul>
</li>
<li><a href="#Example-on-Cassandra-database" title="Example on Cassandra database">Example on Cassandra database</a><ul>
<li><a href="#Define-application-queries" title="Define application queries">Define application queries</a></li>
<li><a href="#Define-logical-data-model" title="Define logical data model">Define logical data model</a></li>
<li><a href="#Physical-data-modeling" title="Physical data modeling">Physical data modeling</a></li>
<li><a href="#Create-the-database-objects" title="Create the database objects">Create the database objects</a></li>
<li><a href="#Populate-data-from-csv-file" title="Populate data from csv file">Populate data from csv file</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#References" title="References">References</a></li>
</ul>
</div><p></p><h1 id="Prerequisites"><a class="anchor hidden-xs" href="#Prerequisites" title="Prerequisites"><i class="fa fa-link"></i></a>Prerequisites</h1><ul>
<li>HDP Sandbox is installed</li>
<li>Familiarity with SQL and PostgreSQL server</li>
</ul><h1 id="Objectives"><a class="anchor hidden-xs" href="#Objectives" title="Objectives"><i class="fa fa-link"></i></a>Objectives</h1><ul>
<li>Access <code>PostgreSQL</code> database server</li>
<li>Review CRUD operations on a relational database</li>
<li>Install Apache Cassandra</li>
<li>Perform some CRUD operations on a distributed database</li>
</ul><h1 id="Introduction"><a class="anchor hidden-xs" href="#Introduction" title="Introduction"><i class="fa fa-link"></i></a>Introduction</h1><p>The Structured Query Language (SQL) is the most extensively used database language. SQL is composed of a data definition language (DDL), which allows the specification of database schemas; a data manipulation language (DML), which supports operations to retrieve, store, modify and delete data. In this lab, we will practice how to retrieve structured data from relational databases using SQL.  Then we will build a graph for the same dataset on Neo4j and return connected data via Cypher queries.</p><h1 id="Dataset-Descripion"><a class="anchor hidden-xs" href="#Dataset-Descripion" title="Dataset-Descripion"><i class="fa fa-link"></i></a>Dataset Descripion</h1><p>This dataset contains four tables about social media users.</p><ul>
<li><strong>users. csv</strong> contains data about the users of the social net.</li>
<li><strong>friends.csv</strong> contains data about their friendship status</li>
<li><strong>posts.csv</strong> contains data about the posts they made</li>
</ul><table>
<thead>
<tr>
<th>File name</th>
<th>Description</th>
<th>Fields</th>
</tr>
</thead>
<tbody>
<tr>
<td>users.csv</td>
<td>A line is added to this file when a user is subscribed to the socia media along with the age and subscription date time</td>
<td>userid, surname, name, age, timestamp</td>
</tr>
<tr>
<td>posts.csv</td>
<td>The user can add multiple posts and for each post we have post type and post unix timestamp</td>
<td>postid, user, posttype, posttimestamp</td>
</tr>
<tr>
<td>friends.csv</td>
<td>The user can have friends and this relationship is mutual</td>
<td>friend1, friend2</td>
</tr>
</tbody>
</table><h1 id="Access-PostgreSQL-server"><a class="anchor hidden-xs" href="#Access-PostgreSQL-server" title="Access-PostgreSQL-server"><i class="fa fa-link"></i></a>Access PostgreSQL server</h1><p>In fact, HDP Sandbox comes with a pre-installed PostgreSQL server so you do not to install any additional software to use PostgreSQL. You can access it via <code>psql</code> as <code>postgres</code> user:</p><pre><code class="sh hljs">[root<span class="hljs-symbol">@sandbox</span>-hdp ~]<span class="hljs-meta">#  psql -U postgres</span>
</code></pre><p>This will open a CLI to interact with PostgreSQL.</p><div class="alert alert-warning">
<p><strong>Note</strong>: When you try to access the database by running the command <code>psql -U postgres</code> as <code>[root@sandbox-hdp data]# psql -U postgres</code>. You may get the following error:</p>
<pre><code>    &gt; psql: FATAL:  Peer authentication failed for user "postgres"  
</code></pre>
<ul>
<li>Possible reasons:
<ul>
<li>The database is configured to allow access only through the credentials of the user.</li>
</ul>
</li>
<li>Possible solutions:
<ul>
<li>You can change this configuration to allow all users to access the database without the need to enter credentials. Add the line <code>local all all trust</code> at the beginning of the file <code>/var/lib/pgsql/data/pg_hba.conf</code> then restart PostgreSQL service by running the command <code>systemctl restart postgresql</code> as root user.</li>
</ul>
</li>
</ul>
</div><p>You can access the databases using <code>\c</code> command and the tables via <code>\dt</code> command. For example, you can access the database <code>ambari</code> (a default database on HDP Sandbox) by running the following command in postgreSQL CLI.</p><pre><code class="sh hljs"><span class="hljs-attribute">postgres</span>=# \c ambari
You are now connected <span class="hljs-keyword">to</span> database <span class="hljs-string">"ambari"</span> as<span class="hljs-built_in"> user </span><span class="hljs-string">"postgres"</span>.
</code></pre><div class="alert alert-info">
<p>The version of PostgreSQL in HDP 2.6.5 is 9.2.23 as shown below. So you should read the documentation for this version of PostgreSQL.</p>
<p><img src="https://i.imgur.com/5pVBcTu.png" alt="" class="md-image md-image"></p>
</div><h1 id="PostgreSQL-Meta-commands"><a class="anchor hidden-xs" href="#PostgreSQL-Meta-commands" title="PostgreSQL-Meta-commands"><i class="fa fa-link"></i></a>PostgreSQL Meta-commands</h1><p>Anything you enter in psql that begins with an unquoted backslash is a psql meta-command that is processed by psql itself. These commands make psql more useful for administration or scripting. Meta-commands are often called slash or backslash commands.</p><ul>
<li>Switch connection to a new database <code>dbname</code> as a user <code>username</code></li>
</ul><pre><code class="sql hljs">\c &lt;dbname&gt; &lt;username&gt;
</code></pre><ul>
<li>List available databases</li>
</ul><pre><code class="sql hljs">\l
</code></pre><ul>
<li>List available tables</li>
</ul><pre><code class="sql hljs">\dt
</code></pre><ul>
<li>Describe a table <code>&lt;table_name&gt;</code></li>
</ul><pre><code class="sql hljs">\d &lt;table_name&gt;
</code></pre><ul>
<li>Execute psql commands from a file <code>&lt;file.sql&gt;</code></li>
</ul><pre><code class="sql hljs">\i &lt;file.sql&gt;
</code></pre><ul>
<li>Get help on psql commands</li>
</ul><pre><code class="sql hljs">\?
\h <span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span>
</code></pre><ul>
<li>Turn on query execution time</li>
</ul><pre><code class="sql hljs">\timing
</code></pre><div class="alert alert-info">
<p>You use the same command <code>\timing</code> to turn it off.</p>
</div><ul>
<li>Quit psql</li>
</ul><pre><code class="sql hljs">\q
</code></pre><div class="alert alert-info">
<p>You can run the shell commands in psql CLI via <code>\! </code>. For instance, to print the current working directory we write:</p>
<pre><code class="wrap powershell hljs">\! pwd
</code></pre>
</div><h1 id="Build-the-Database"><a class="anchor hidden-xs" href="#Build-the-Database" title="Build-the-Database"><i class="fa fa-link"></i></a>Build the Database</h1><div class="alert alert-warning">
<p>Note: Explore the dataset using any data analysis tool (Python+Pandas, Excel, Google Sheet, …etc) you have before building the database.</p>
<p>Another note: You do not need to create a new role/user. Just use the current role <code>postgres</code>.</p>
</div><p>The dataset are csv files and need to be imported into PostgreSQL tables.</p><p>To copy the values from csv files into the table, you need to use Postgres <code>COPY</code> method od data-loading. Postgres’s COPY comes in two separate variants, COPY and \COPY: COPY is server based, \COPY is client based. COPY will be run by the PostgreSQL backend (user “postgres”). The backend user requires permissions to read &amp; write to the data file in order to copy from/to it. You need to use an absolute pathname with COPY. \COPY on the other hand, runs under the current $USER, and with that users environment. And \COPY can handle relative pathnames. The psql \COPY is accordingly much easier to use if it handles what you need. So, you can use the meta-command <code>\COPY</code> to import the data from csv files into PostgreSQL tables but you need to make sure that the primary keys and foreign keys are set according to the given ER diagram. You can learn more about ER diagrams from <a href="https://www.lucidchart.com/pages/ER-diagram-symbols-and-meaning" target="_blank" rel="noopener">here</a>.</p><div class="alert alert-warning">
<p>Notice that you need to create tables before importing their data from files. You can detect the datatype of the column from its values.</p>
</div><ol>
<li>Create the database <code>social</code></li>
</ol><pre><code class="wrap sql hljs"><span class="hljs-comment">-- Create Database</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">DATABASE</span> social;

<span class="hljs-comment">-- Switch to the Database</span>
\c social;

<span class="hljs-comment">-- add User table</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> <span class="hljs-keyword">Users</span>(
userid <span class="hljs-built_in">INT</span> PRIMARY <span class="hljs-keyword">KEY</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
surname <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">50</span>),
<span class="hljs-keyword">name</span> <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">50</span>),
age <span class="hljs-built_in">INT</span>,
_timestamp <span class="hljs-built_in">timestamp</span>,
temp <span class="hljs-built_in">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>
);

<span class="hljs-comment">-- add Post table</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> Posts(
postid <span class="hljs-built_in">INT</span> PRIMARY <span class="hljs-keyword">KEY</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
userid <span class="hljs-built_in">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
posttype <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">50</span>),
posttimestamp <span class="hljs-built_in">timestamp</span>,
temp <span class="hljs-built_in">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>
);

<span class="hljs-comment">-- add Friend table</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> Friends(
friend1 <span class="hljs-built_in">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
friend2 <span class="hljs-built_in">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>
);

<span class="hljs-comment">-- add constrains</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> Friends
<span class="hljs-keyword">ADD</span> <span class="hljs-keyword">CONSTRAINT</span> fk_User_userid_friend1
<span class="hljs-keyword">FOREIGN</span> <span class="hljs-keyword">KEY</span> (friend1)
<span class="hljs-keyword">REFERENCES</span> <span class="hljs-keyword">Users</span> (userid);

<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> Friends
<span class="hljs-keyword">ADD</span> <span class="hljs-keyword">CONSTRAINT</span> fk_User_userid_friend2
<span class="hljs-keyword">FOREIGN</span> <span class="hljs-keyword">KEY</span> (friend2)
<span class="hljs-keyword">REFERENCES</span> <span class="hljs-keyword">Users</span> (userid);

<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> Posts
<span class="hljs-keyword">ADD</span> <span class="hljs-keyword">CONSTRAINT</span> fk_User_userid_userid
<span class="hljs-keyword">FOREIGN</span> <span class="hljs-keyword">KEY</span> (userid)
<span class="hljs-keyword">REFERENCES</span> <span class="hljs-keyword">Users</span> (userid);
</code></pre><ol start="2">
<li>Upload the csv data into tables</li>
</ol><pre><code class="wrap sql hljs">
\COPY Users(userid, surname, name, age, temp)  FROM 'users.csv'  DELIMITER ','  CSV HEADER;
<span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">Users</span> <span class="hljs-keyword">SET</span> _timestamp = TO_TIMESTAMP(temp);
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">Users</span> <span class="hljs-keyword">DROP</span> <span class="hljs-keyword">COLUMN</span> temp;


\COPY Posts(postid, userid, posttype, temp) FROM 'posts.csv' CSV HEADER;
<span class="hljs-keyword">UPDATE</span> Posts <span class="hljs-keyword">SET</span> posttimestamp = TO_TIMESTAMP(temp);
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> Posts <span class="hljs-keyword">DROP</span> <span class="hljs-keyword">COLUMN</span> temp;


\COPY Friends from 'friends.csv' csv header;
</code></pre><h2 id="Fix-Friends-table"><a class="anchor hidden-xs" href="#Fix-Friends-table" title="Fix-Friends-table"><i class="fa fa-link"></i></a>Fix Friends table</h2><pre><code class="wrap sql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> friends2 <span class="hljs-keyword">AS</span>
<span class="hljs-keyword">SELECT</span> friend1, friend2 <span class="hljs-keyword">FROM</span> friends
<span class="hljs-keyword">UNION</span>
<span class="hljs-keyword">SELECT</span> friend2, friend1 <span class="hljs-keyword">FROM</span> friends;


<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> friends <span class="hljs-keyword">RENAME</span> <span class="hljs-keyword">TO</span> friends_old;

<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> friends2 <span class="hljs-keyword">RENAME</span> <span class="hljs-keyword">TO</span> friends;

</code></pre><h1 id="Data-Retrieval-using-SQL"><a class="anchor hidden-xs" href="#Data-Retrieval-using-SQL" title="Data-Retrieval-using-SQL"><i class="fa fa-link"></i></a>Data Retrieval using SQL</h1><p>In this part of the lab, we will practice on writing SQL queries to retrieve data from our database.</p><h2 id="Data-Retrieval-from-a-single-table"><a class="anchor hidden-xs" href="#Data-Retrieval-from-a-single-table" title="Data-Retrieval-from-a-single-table"><i class="fa fa-link"></i></a>Data Retrieval from a single table</h2><p>You can return data from a single table by using <code>SELECT</code> command. This kind of data retrieval is the simplest way to get data from a single table.</p><div class="alert alert-success">
<h3 id="Exercises"><a class="anchor hidden-xs" href="#Exercises" title="Exercises"><i class="fa fa-link"></i></a>Exercises</h3>
<ol>
<li>Who are the users who have posts?</li>
</ol>
<pre><code class="wrap sql hljs"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> userid
<span class="hljs-keyword">FROM</span> posts;
</code></pre>
<ol start="2">
<li>What are the posts of the users?</li>
</ol>
<pre><code class="wrap sql hljs"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> postid
<span class="hljs-keyword">FROM</span> posts;
</code></pre>
<ol start="3">
<li>Which posts published after 2012?</li>
</ol>
<pre><code class="wrap sql hljs"><span class="hljs-keyword">SELECT</span> *
<span class="hljs-keyword">FROM</span> posts
<span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">EXTRACT</span>(<span class="hljs-keyword">YEAR</span> <span class="hljs-keyword">FROM</span> posttimestamp) &gt; <span class="hljs-number">2012</span>;
</code></pre>
<ol start="4">
<li>What is the oldest and recent dates of the posts?</li>
</ol>
<pre><code class="wrap sql hljs"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">MAX</span>(posttimestamp), <span class="hljs-keyword">MIN</span>(posttimestamp)
<span class="hljs-keyword">FROM</span> posts;
</code></pre>
<ol start="5">
<li>What are the top 5 most recent posts whose type is <code>Image</code>?</li>
</ol>
<pre><code class="wrap sql hljs"><span class="hljs-keyword">SELECT</span> * 
<span class="hljs-keyword">FROM</span> posts
<span class="hljs-keyword">WHERE</span> posttype=<span class="hljs-string">'Image'</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> posttimestamp <span class="hljs-keyword">DESC</span>
<span class="hljs-keyword">LIMIT</span> <span class="hljs-number">5</span>;
</code></pre>
<ol start="6">
<li>Which top 5 users who posted an <code>Image</code> or <code>Video</code> recently?</li>
</ol>
<pre><code class="wrap sql hljs"><span class="hljs-keyword">SELECT</span> userid, posttype
<span class="hljs-keyword">FROM</span> posts
<span class="hljs-keyword">WHERE</span> posttype <span class="hljs-keyword">IN</span> (<span class="hljs-string">'Image'</span>, <span class="hljs-string">'Video'</span>)
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> posttimestamp <span class="hljs-keyword">DESC</span>
<span class="hljs-keyword">LIMIT</span> <span class="hljs-number">5</span>;
</code></pre>
<ol start="7">
<li>What is the age of the eldest and youngest persons?</li>
</ol>
<pre><code class="wrap sql hljs"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">MAX</span>(age), <span class="hljs-keyword">MIN</span>(age)
<span class="hljs-keyword">FROM</span> <span class="hljs-keyword">users</span>;

<span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">users</span>
<span class="hljs-keyword">SET</span> age = <span class="hljs-keyword">CASE</span>
           <span class="hljs-keyword">WHEN</span> age &lt; <span class="hljs-number">0</span> <span class="hljs-keyword">THEN</span> -age
           <span class="hljs-keyword">ELSE</span> age
          <span class="hljs-keyword">END</span>;

</code></pre>
</div><div class="alert alert-warning">
<p>In PostgreSQL, double quotes <code>""</code> are used to indicate identifiers within the database, which are objects like tables, column names, and roles. In contrast, single quotes <code>''</code> are used to indicate string literals.</p>
</div><h2 id="Data-Retrieval-from-multiple-tables-Joining-tables"><a class="anchor hidden-xs" href="#Data-Retrieval-from-multiple-tables-Joining-tables" title="Data-Retrieval-from-multiple-tables-Joining-tables"><i class="fa fa-link"></i></a>Data Retrieval from multiple tables (Joining tables)</h2><div class="alert alert-success">
<h3 id="Exercises1"><a class="anchor hidden-xs" href="#Exercises1" title="Exercises1"><i class="fa fa-link"></i></a>Exercises</h3>
<ol start="8">
<li>Who is the 2nd youngest person who published <code>Image</code> posts?</li>
</ol>
<pre><code class="wrap sql hljs"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> <span class="hljs-keyword">name</span>, surname, age, posttype
<span class="hljs-keyword">FROM</span> posts 
<span class="hljs-keyword">JOIN</span> <span class="hljs-keyword">users</span> <span class="hljs-keyword">ON</span> posts.userid = users.userid
<span class="hljs-keyword">WHERE</span> posts.posttype=<span class="hljs-string">'Image'</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> age <span class="hljs-keyword">ASC</span>
<span class="hljs-keyword">LIMIT</span> <span class="hljs-number">1</span>
<span class="hljs-keyword">OFFSET</span> <span class="hljs-number">1</span>;
</code></pre>
<ol start="9">
<li>What are the posts that are published by people who are between 20 and 30?</li>
</ol>
<pre><code class="wrap sql hljs"><span class="hljs-keyword">SELECT</span> postid, posttype, age, users.userid
<span class="hljs-keyword">FROM</span> posts 
<span class="hljs-keyword">JOIN</span> <span class="hljs-keyword">users</span> <span class="hljs-keyword">ON</span> posts.userid = users.userid
<span class="hljs-keyword">WHERE</span> age &lt;@ int4range(<span class="hljs-number">20</span>, <span class="hljs-number">30</span>)
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> age;
</code></pre>
<ol start="10">
<li>What are the friends of the youngest person?</li>
</ol>
<pre><code class="wrap sql hljs"><span class="hljs-keyword">WITH</span> youngest <span class="hljs-keyword">AS</span>(
    <span class="hljs-keyword">SELECT</span> userid 
    <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">users</span> 
    <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> age 
    <span class="hljs-keyword">ASC</span> <span class="hljs-keyword">LIMIT</span> <span class="hljs-number">1</span>
)
<span class="hljs-keyword">SELECT</span> friend1 <span class="hljs-keyword">AS</span> <span class="hljs-keyword">user</span>, friend2 <span class="hljs-keyword">AS</span> friend
<span class="hljs-keyword">FROM</span> youngest, friends
<span class="hljs-keyword">JOIN</span> <span class="hljs-keyword">users</span> <span class="hljs-keyword">ON</span> friends.friend1 = users.userid
<span class="hljs-keyword">WHERE</span> users.userid = youngest.userid;
</code></pre>
<ol start="11">
<li>How many friends for the surname <code>Thronton</code>?</li>
</ol>
<pre><code class="wrap sql hljs"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">COUNT</span>(friend2)
<span class="hljs-keyword">FROM</span> <span class="hljs-keyword">users</span>
<span class="hljs-keyword">JOIN</span> friends <span class="hljs-keyword">ON</span> (users.userid = friends.friend1)
<span class="hljs-keyword">WHERE</span> users.surname = <span class="hljs-string">'Thronton'</span>;
</code></pre>
</div><h2 id="Aggregation-and-grouping"><a class="anchor hidden-xs" href="#Aggregation-and-grouping" title="Aggregation-and-grouping"><i class="fa fa-link"></i></a>Aggregation and grouping</h2><div class="alert alert-success">
<h3 id="Exercises2"><a class="anchor hidden-xs" href="#Exercises2" title="Exercises2"><i class="fa fa-link"></i></a>Exercises</h3>
<ol start="12">
<li>How many posts for each user?</li>
</ol>
<pre><code class="wrap sql hljs"><span class="hljs-keyword">SELECT</span> users.userid, <span class="hljs-keyword">COUNT</span>(*) <span class="hljs-keyword">as</span> c
<span class="hljs-keyword">FROM</span> <span class="hljs-keyword">users</span>
<span class="hljs-keyword">JOIN</span> posts <span class="hljs-keyword">ON</span> (users.userid = posts.userid)
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> users.userid
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> c <span class="hljs-keyword">DESC</span>;
</code></pre>
<ol start="13">
<li>Who are the friends of users who posted <code>Image</code>?</li>
</ol>
<pre><code class="wrap sql hljs"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> u2.userid, u2.name, u2.surname, u2.age, u.userid, u.name, u.surname
<span class="hljs-keyword">FROM</span> <span class="hljs-keyword">users</span> u
<span class="hljs-keyword">JOIN</span> friends f <span class="hljs-keyword">ON</span> f.friend1 = u.userid
<span class="hljs-keyword">JOIN</span> posts <span class="hljs-keyword">ON</span> posts.userid = u.userid
<span class="hljs-keyword">JOIN</span> <span class="hljs-keyword">users</span> u2 <span class="hljs-keyword">ON</span> f.friend2 = u2.userid
<span class="hljs-keyword">WHERE</span> posts.posttype = <span class="hljs-string">'Image'</span>;
</code></pre>
<ol start="14">
<li>How many friends of users whose age is less than 20?</li>
</ol>
<pre><code class="wrap sql hljs"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> f1.friend2) <span class="hljs-keyword">as</span> c
<span class="hljs-keyword">FROM</span> <span class="hljs-keyword">users</span> u
<span class="hljs-keyword">JOIN</span> friends f1 <span class="hljs-keyword">ON</span> (u.userid = f1.friend1)
<span class="hljs-keyword">WHERE</span> u.age &lt; <span class="hljs-number">20</span>;
</code></pre>
<ol start="15">
<li>How many friends of friends of users whose age is less than 20?</li>
</ol>
<pre><code class="wrap sql hljs"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> f2.friend2) <span class="hljs-keyword">as</span> c
<span class="hljs-keyword">FROM</span> <span class="hljs-keyword">users</span> u
<span class="hljs-keyword">JOIN</span> friends f1 <span class="hljs-keyword">ON</span> (u.userid = f1.friend1)
<span class="hljs-keyword">JOIN</span> friends f2 <span class="hljs-keyword">ON</span> (f1.friend2 = f2.friend1)
<span class="hljs-keyword">WHERE</span> u.age &lt; <span class="hljs-number">20</span> <span class="hljs-keyword">AND</span> f2.friend2 &lt;&gt; u.userid;
</code></pre>
<ol start="16">
<li>How many users have more than 10 posts?</li>
</ol>
<pre><code class="wrap sql hljs"><span class="hljs-keyword">WITH</span> users_10_posts <span class="hljs-keyword">AS</span> (
    <span class="hljs-keyword">SELECT</span> posts.userid, <span class="hljs-keyword">COUNT</span>(*) <span class="hljs-keyword">as</span> c
    <span class="hljs-keyword">FROM</span> posts
    <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> posts.userid
    <span class="hljs-keyword">HAVING</span> <span class="hljs-keyword">COUNT</span>(*) &gt; <span class="hljs-number">10</span>
)
<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">COUNT</span>(*) <span class="hljs-keyword">as</span> c
<span class="hljs-keyword">FROM</span> users_10_posts;
</code></pre>
<ol start="17">
<li>What is the average number of posts published at noon and by the friends of the users whose age is more than 40? Calculate the percentage of posts.</li>
</ol>
<pre><code class="wrap sql hljs">
<span class="hljs-keyword">WITH</span> post_count <span class="hljs-keyword">AS</span> (
    <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">COUNT</span>(posts.postid) <span class="hljs-keyword">AS</span> c
    <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">users</span> u
    <span class="hljs-keyword">JOIN</span> friends f <span class="hljs-keyword">ON</span> f.friend1 = u.userid
    <span class="hljs-keyword">JOIN</span> posts <span class="hljs-keyword">ON</span> posts.userid = f.friend1
    <span class="hljs-keyword">JOIN</span> <span class="hljs-keyword">users</span> u2 <span class="hljs-keyword">ON</span> f.friend1 = u2.userid
    <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">EXTRACT</span>(<span class="hljs-keyword">HOUR</span> <span class="hljs-keyword">FROM</span> u2._timestamp) = <span class="hljs-number">12</span> <span class="hljs-keyword">AND</span> u.age &gt; <span class="hljs-number">40</span>
)
<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">AVG</span>(c)
<span class="hljs-keyword">FROM</span> post_count;
</code></pre>
<ol start="18">
<li>What is the percentage of posts published at noon and by the friends of the users whose age is more than 40?</li>
</ol>
<pre><code class="wrap sql hljs"><span class="hljs-keyword">WITH</span> post_count <span class="hljs-keyword">AS</span> (
    <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">COUNT</span>(posts.postid) <span class="hljs-keyword">AS</span> c
    <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">users</span> u
    <span class="hljs-keyword">JOIN</span> friends f <span class="hljs-keyword">ON</span> f.friend1 = u.userid
    <span class="hljs-keyword">JOIN</span> posts <span class="hljs-keyword">ON</span> posts.userid = f.friend1
    <span class="hljs-keyword">JOIN</span> <span class="hljs-keyword">users</span> u2 <span class="hljs-keyword">ON</span> f.friend1 = u2.userid
    <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">EXTRACT</span>(<span class="hljs-keyword">HOUR</span> <span class="hljs-keyword">FROM</span> u2._timestamp) = <span class="hljs-number">12</span> <span class="hljs-keyword">AND</span> u.age &gt; <span class="hljs-number">40</span>) ,
    post_total <span class="hljs-keyword">AS</span> (
        <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">COUNT</span>(*) <span class="hljs-keyword">as</span> c2
        <span class="hljs-keyword">FROM</span> posts
    )
<span class="hljs-keyword">SELECT</span> <span class="hljs-number">100</span> * c/c2 || <span class="hljs-string">'%'</span>
<span class="hljs-keyword">FROM</span> post_total, post_count;
</code></pre>
</div><h2 id="Citus-Data"><a class="anchor hidden-xs" href="#Citus-Data" title="Citus-Data"><i class="fa fa-link"></i></a>Citus Data</h2><p>It is called distributed Postgres. The Citus database distributes your Postgres tables or schemas across multiple nodes and parallelizes your queries and transactions. The combination of parallelism, keeping more data in memory, and higher I/O bandwidth often leads to dramatic speed ups. In this chart, we show a benchmark SQL query running ~40x faster with an 8-node Citus cluster vs. a single Postgres node.</p><p><img src="https://www.citusdata.com/assets/images/diagrams/performance-bar-chart.svg" alt="" class="md-image md-image"></p><h4 id="Run-a-cluster-of-Citus-nodes"><a class="anchor hidden-xs" href="#Run-a-cluster-of-Citus-nodes" title="Run-a-cluster-of-Citus-nodes"><i class="fa fa-link"></i></a>Run a cluster of Citus nodes</h4><ol>
<li>Prepare the docker compose file.</li>
</ol><pre><code class="yaml hljs"><span class="hljs-string">curl</span> <span class="hljs-bullet">-L</span> <span class="hljs-attr">https://raw.githubusercontent.com/citusdata/docker/master/docker-compose.yml</span> <span class="hljs-string">&gt; docker-compose.yml
</span></code></pre><ol start="2">
<li>Create and run the cluster of 10 nodes.</li>
</ol><pre><code class="wrap yaml hljs"><span class="hljs-string">COMPOSE_PROJECT_NAME=citus</span> <span class="hljs-string">docker-compose</span> <span class="hljs-string">up</span> <span class="hljs-bullet">-d</span> <span class="hljs-bullet">--scale</span> <span class="hljs-string">worker=10</span>
</code></pre><ol start="3">
<li>Access psql of the master node and run queries.</li>
</ol><pre><code class="wrap yaml hljs"> <span class="hljs-string">docker</span> <span class="hljs-string">exec</span> <span class="hljs-bullet">-it</span> <span class="hljs-string">citus_master</span> <span class="hljs-string">psql</span> <span class="hljs-bullet">-U</span> <span class="hljs-string">postgres</span>
</code></pre><h1 id="Apache-Cassandra"><a class="anchor hidden-xs" href="#Apache-Cassandra" title="Apache-Cassandra"><i class="fa fa-link"></i></a>Apache Cassandra</h1><p>The Cassandra data store is an open source Apache project. Cassandra originated at <strong>Facebook</strong> in 2007 to solve its inbox search problem where the company had to deal with large volumes of data in a way that was difficult to scale with traditional methods. Cassandra is being used by some of the biggest companies such as Facebook, Twitter, Cisco, Rackspace, ebay, Twitter, Netflix, and more.</p><p>When deadling with Cassandra, keep the following features in mind:</p><ul>
<li><em>Data is stored in tables</em></li>
<li><em>Denormalize your tables</em></li>
<li><em>No joins between tables and no foreign keys</em></li>
<li><em>Rows are gigantic and sorted</em></li>
<li><em>One row, one machine</em>: Each row stays on one machine. Rows are not sharded across nodes.</li>
<li><em>Query driven data modeling</em></li>
</ul><h2 id="Installing-Cassandra"><a class="anchor hidden-xs" href="#Installing-Cassandra" title="Installing-Cassandra"><i class="fa fa-link"></i></a>Installing Cassandra</h2><p>Cassandra runs on a wide array of Linux distributions. Cassandra is written in Java. You can install it on your local machine (bare metal installation) if you have latest version of Java 8 or Java 11 and Python 3.6+ for using cqlsh (CQL shell).</p><h3 id="Single-node-Cassandra-server-installation"><a class="anchor hidden-xs" href="#Single-node-Cassandra-server-installation" title="Single-node-Cassandra-server-installation"><i class="fa fa-link"></i></a>Single-node Cassandra server installation</h3><p>You can install Cassandra by following the instructions in the <a href="https://cassandra.apache.org/doc/stable/cassandra/getting_started/installing.html" target="_blank" rel="noopener">official website</a> but here I will show the steps to install a single instance of Cassandra using Docker.</p><ol>
<li>Pull the latest version of Cassandra:</li>
</ol><pre><code class="yaml hljs"><span class="hljs-string">docker</span> <span class="hljs-string">pull</span> <span class="hljs-attr">cassandra:latest</span>
</code></pre><ol start="2">
<li>Create a Cassandra container and run it in detached mode:</li>
</ol><pre><code class="yaml hljs"><span class="hljs-string">docker</span> <span class="hljs-string">run</span> <span class="hljs-bullet">--name</span> <span class="hljs-string">cass_server</span> <span class="hljs-bullet">--network</span> <span class="hljs-string">cass_net</span> <span class="hljs-bullet">--detach</span>  <span class="hljs-attr">cassandra:latest</span>
</code></pre><div class="alert alert-warning">
<p>For the first time, before running the command above, ensure that the container is stopped and does not exist.</p>
<pre><code class="yaml hljs"><span class="hljs-string">docker</span> <span class="hljs-string">stop</span> <span class="hljs-string">cass_server</span>
<span class="hljs-string">docker</span> <span class="hljs-string">rm</span> <span class="hljs-string">cass_server</span>
</code></pre>
<p>For the next time, you just need to start the container.</p>
<pre><code class="yaml hljs"><span class="hljs-string">docker</span> <span class="hljs-string">start</span> <span class="hljs-string">cass_server</span>
</code></pre>
</div><ol start="3">
<li>Now the Cassandra server should run in the container <code>cass_server</code>. You need CQL shell to interact with it. You can start the CQL shell:</li>
</ol><pre><code class="yaml hljs"><span class="hljs-string">docker</span> <span class="hljs-string">exec</span> <span class="hljs-bullet">-it</span> <span class="hljs-string">cass_server</span> <span class="hljs-string">cqlsh</span>
</code></pre><p>Now you will be able to run CQL commands and execute statements written in Cassandra Query Language. Notice that this container  is a single node of Cassandra server. If you want to run a cluster of Cassandra nodes, you need to go to the next section.</p><div class="alert alert-warning">
<p>If you encounter errors like below</p>
<pre><code class="wrap clike hljs">firasj<span class="hljs-variable">@Lenovo</span><span class="hljs-symbol">:~</span><span class="hljs-variable">$ </span>docker exec -it cass_server cqlsh
Connection <span class="hljs-symbol">error:</span> (<span class="hljs-string">'Unable to connect to any servers'</span>, {<span class="hljs-string">'127.0.0.1:9042'</span>: ConnectionRefusedError(<span class="hljs-number">111</span>, <span class="hljs-string">"Tried connecting to [('127.0.0.1', 9042)]. Last error: Connection refused"</span>)})
</code></pre>
<p>It could be related to Gossip protocol issue that is used for inter-node communication. Wait till the server properly runs.</p>
</div><h3 id="Multi-node-Cassandra-cluster"><a class="anchor hidden-xs" href="#Multi-node-Cassandra-cluster" title="Multi-node-Cassandra-cluster"><i class="fa fa-link"></i></a>Multi-node Cassandra cluster</h3><div class="alert alert-danger">
<p><strong>Important:</strong> Do not deploy multi-node cluster on your local machine if you have less than 16GB RAM memory size since each Cassandra node will minimally need 4GB. If you have 12GB, you may try to run a cluster of two Cassandra nodes.</p>
</div><p>We can run a cluster of three Casandra nodes by following one of the ways:</p><h4 id="1-Without-using-Docker-compose"><a class="anchor hidden-xs" href="#1-Without-using-Docker-compose" title="1-Without-using-Docker-compose"><i class="fa fa-link"></i></a>1. Without using Docker compose</h4><ol>
<li>Pull the Cassandra image.</li>
</ol><pre><code class="wrap yaml hljs"><span class="hljs-string">docker</span> <span class="hljs-string">pull</span> <span class="hljs-attr">cassandra:latest</span>
</code></pre><ol start="2">
<li>Run the first node. We assume that the first node is the client node too.</li>
</ol><pre><code class="wrap yaml hljs"><span class="hljs-string">docker</span> <span class="hljs-string">run</span> <span class="hljs-bullet">--name</span> <span class="hljs-string">cassandra-1</span> <span class="hljs-bullet">--network</span> <span class="hljs-string">cassandra_net</span> <span class="hljs-bullet">-d</span> <span class="hljs-attr">cassandra:latest</span>
</code></pre><p>To start other instances, just tell each new node where the first is (set the environment variable <code>CASSANDRA_SEEDS</code>).<br>
3. Run the second node.</p><pre><code class="wrap yaml hljs"><span class="hljs-string">docker</span> <span class="hljs-string">run</span> <span class="hljs-bullet">--name</span> <span class="hljs-string">cassandra-2</span> <span class="hljs-bullet">--network</span> <span class="hljs-string">cassandra_net</span> <span class="hljs-bullet">-d</span>  <span class="hljs-bullet">-e</span> <span class="hljs-string">CASSANDRA_SEEDS=cassandra-1</span> <span class="hljs-attr">cassandra:latest</span>
</code></pre><ol start="4">
<li>Run the third node.</li>
</ol><pre><code class="wrap yaml hljs"><span class="hljs-string">docker</span> <span class="hljs-string">run</span> <span class="hljs-bullet">--name</span> <span class="hljs-string">cassandra-3</span> <span class="hljs-bullet">--network</span> <span class="hljs-string">cassandra_net</span> <span class="hljs-bullet">-d</span>  <span class="hljs-bullet">-e</span> <span class="hljs-string">CASSANDRA_SEEDS=cassandra-2</span> <span class="hljs-attr">cassandra:latest</span>
</code></pre><p>You can check the status of the cluster by running the command on one of the nodes:</p><pre><code class="yaml hljs"><span class="hljs-string">docker</span> <span class="hljs-string">exec</span> <span class="hljs-string">cassandra-1</span> <span class="hljs-string">nodetool</span> <span class="hljs-string">status</span>
</code></pre><p><img src="https://i.imgur.com/BKgbw23.png" alt="" class="md-image md-image"></p><p><code>UN</code> means that the servers are up and normal.</p><h4 id="2-Using-Docker-Compose"><a class="anchor hidden-xs" href="#2-Using-Docker-Compose" title="2-Using-Docker-Compose"><i class="fa fa-link"></i></a>2. Using Docker Compose</h4><p>Here, I will share the steps to run a Cassandra cluster of 3 nodes by following the instructions in <a href="https://github.com/kayvansol/Cassandra" target="_blank" rel="noopener">this repository</a>. Make sure that you have Docker compose installed, otherwise follow <a href="https://docs.docker.com/compose/install/" target="_blank" rel="noopener">this tutorial</a> to install it. The steps to create a cluster of 3 Cassandra nodes are:</p><ol>
<li>Pull the Cassandra image.</li>
</ol><pre><code class="wrap yaml hljs"><span class="hljs-string">docker</span> <span class="hljs-string">pull</span> <span class="hljs-attr">cassandra:latest</span>
</code></pre><ol start="2">
<li>Create <code>docker-compose.yaml</code> file has the following content.</li>
</ol><pre><code class="dockerfile hljs">
networks:
  cassandra-net:
    driver: bridge

services:

  cassandra-<span class="hljs-number">1</span>:
    image: <span class="hljs-string">"cassandra:latest"</span>
    container_name: <span class="hljs-string">"cassandra-1"</span>
    ports:
      - <span class="hljs-number">7000</span>:<span class="hljs-number">7000</span>
      - <span class="hljs-number">9042</span>:<span class="hljs-number">9042</span>
    networks:
      - cassandra-net
    environment:
      - CASSANDRA_LISTEN_ADDRESS=auto  <span class="hljs-comment"># default, use IP addr of container # = CASSANDRA_BROADCAST_ADDRESS</span>
      - CASSANDRA_CLUSTER_NAME=my-cluster
      - CASSANDRA_ENDPOINT_SNITCH=GossipingPropertyFileSnitch
      - CASSANDRA_DC=my-datacenter-<span class="hljs-number">1</span>
    volumes:
      - cassandra-node-<span class="hljs-number">1</span>:/var/lib/cassandra:rw
    restart:
      on-failure
    <span class="hljs-keyword">healthcheck</span><span class="bash">:</span>
      test: [<span class="hljs-string">"CMD-SHELL"</span>, <span class="hljs-string">"nodetool status"</span>]
      interval: <span class="hljs-number">2</span>m
      start_period: <span class="hljs-number">2</span>m
      timeout: <span class="hljs-number">10</span>s
      retries: <span class="hljs-number">3</span>

  cassandra-<span class="hljs-number">2</span>:
    image: <span class="hljs-string">"cassandra:latest"</span>
    container_name: <span class="hljs-string">"cassandra-2"</span>
    ports:
      - <span class="hljs-number">9043</span>:<span class="hljs-number">9042</span>
    networks:
      - cassandra-net
    environment:
      - CASSANDRA_LISTEN_ADDRESS=auto  <span class="hljs-comment"># default, use IP addr of container # = CASSANDRA_BROADCAST_ADDRESS</span>
      - CASSANDRA_CLUSTER_NAME=my-cluster
      - CASSANDRA_ENDPOINT_SNITCH=GossipingPropertyFileSnitch
      - CASSANDRA_DC=my-datacenter-<span class="hljs-number">1</span>
      - CASSANDRA_SEEDS=cassandra-<span class="hljs-number">1</span>
    depends_on:
      cassandra-<span class="hljs-number">1</span>:
        condition: service_healthy
    volumes:
      - cassandra-node-<span class="hljs-number">2</span>:/var/lib/cassandra:rw
    restart:
      on-failure
    <span class="hljs-keyword">healthcheck</span><span class="bash">:</span>
      test: [<span class="hljs-string">"CMD-SHELL"</span>, <span class="hljs-string">"nodetool status"</span>]
      interval: <span class="hljs-number">2</span>m
      start_period: <span class="hljs-number">2</span>m
      timeout: <span class="hljs-number">10</span>s
      retries: <span class="hljs-number">3</span>

  cassandra-<span class="hljs-number">3</span>:
    image: <span class="hljs-string">"cassandra:latest"</span>
    container_name: <span class="hljs-string">"cassandra-3"</span>
    ports:
      - <span class="hljs-number">9044</span>:<span class="hljs-number">9042</span>
    networks:
      - cassandra-net
    environment:
      - CASSANDRA_LISTEN_ADDRESS=auto  <span class="hljs-comment"># default, use IP addr of container # = CASSANDRA_BROADCAST_ADDRESS</span>
      - CASSANDRA_CLUSTER_NAME=my-cluster
      - CASSANDRA_ENDPOINT_SNITCH=GossipingPropertyFileSnitch
      - CASSANDRA_DC=my-datacenter-<span class="hljs-number">1</span>
      - CASSANDRA_SEEDS=cassandra-<span class="hljs-number">1</span>
    depends_on:
      cassandra-<span class="hljs-number">2</span>:
        condition: service_healthy
    volumes:
      - cassandra-node-<span class="hljs-number">3</span>:/var/lib/cassandra:rw
    restart:
      on-failure
    <span class="hljs-keyword">healthcheck</span><span class="bash">:</span>
      test: [<span class="hljs-string">"CMD-SHELL"</span>, <span class="hljs-string">"nodetool status"</span>]
      interval: <span class="hljs-number">2</span>m
      start_period: <span class="hljs-number">2</span>m
      timeout: <span class="hljs-number">10</span>s
      retries: <span class="hljs-number">3</span>

volumes:
  cassandra-node-<span class="hljs-number">1</span>:
  cassandra-node-<span class="hljs-number">2</span>:
  cassandra-node-<span class="hljs-number">3</span>:
</code></pre><ol start="3">
<li>Deploy the cluster.</li>
</ol><pre><code class="wrap yaml hljs"><span class="hljs-string">docker</span> <span class="hljs-string">compose</span> <span class="hljs-bullet">--file</span> <span class="hljs-string">docker-compose.yaml</span> <span class="hljs-string">up</span> <span class="hljs-bullet">-d</span> 
</code></pre><p>The containers will start in order (one after another) and you need to wait till all containers join the cluster.</p><p>Make sure that all containers are running and healthy. You will get something like this.<br>
<img src="https://i.imgur.com/d7pVat3.png" alt="" class="md-image md-image"></p><p>You can use <code>nodetool</code> to check the status of nodes.</p><pre><code class="wrap yaml hljs"><span class="hljs-string">docker</span> <span class="hljs-string">exec</span> <span class="hljs-string">cassandra-1</span> <span class="hljs-string">nodetool</span> <span class="hljs-string">status</span>
</code></pre><p>Where <code>cassandra-1</code> can be replaced with any node in the cluster.</p><p><img src="https://i.imgur.com/ldSbPrL.png" alt="" class="md-image md-image"><br>
<code>UN</code> means that the servers are up and normal.</p><h2 id="Cassandra-data-model"><a class="anchor hidden-xs" href="#Cassandra-data-model" title="Cassandra-data-model"><i class="fa fa-link"></i></a>Cassandra data model</h2><p>Apache Cassandra stores data in <strong>tables</strong> (“Column family” is the old name for a table), with each table consisting of <strong>rows</strong> and <strong>columns</strong>. CQL (Cassandra Query Language) is used to query the data stored in tables. Apache Cassandra data model is based around and optimized for <em>querying</em>. Cassandra <strong>does not</strong> support <strong>relational</strong> data modeling intended for relational databases.</p><p>CQL stores data in tables, whose schema defines the layout of the data in the table. Tables are located in keyspaces. A <strong>keyspace</strong> defines options that apply to all the keyspace’s tables. The replication strategy is an important keyspace option, as is the <strong>replication factor</strong>. A good general rule is one keyspace per application.</p><p><img src="https://i.imgur.com/GVWfuTK.png" alt="" class="md-image md-image"></p><p>A <strong>cell</strong> is the smallest unit of the Cassandra data model. Cells are contained within a table. A cell is essentially a key-value pair. The key of a cell is called cell name and value is called cell value. A cell can be represented as a triplet of the cell name, value, and timestamp. The timestamp is used to resolve conflicts during read repair or to reconcile two writes that happen to the same cell at the same time; the one written later wins.</p><div class="alert alert-info">
<p>In Cassandra:</p>
<ul>
<li>a table is a list of “nested key-value pairs”. (Row x Column Key x Column value)</li>
<li>keyspace is the outermost container which contains data corresponding to an application.</li>
<li>tables or column families are the entity of a keyspace</li>
<li>row is a unit of replication</li>
</ul>
<!-- - column is a unit of storage -->
<ul>
<li>relationships are represented using collections</li>
</ul>
</div><p>In Cassandra, data modeling is <strong>query-driven</strong>.</p><ul>
<li>The data access patterns and application queries determine the structure and organization of data which then used to design the database tables.</li>
<li>Data is modeled around specific queries. Queries are best designed to access a single table, which implies that all entities involved in a query must be in the same table to make <strong>data access (reads) very fast</strong>.</li>
<li>Unlike a relational database model in which queries make use of table joins to get data from multiple tables, joins are not supported in Cassandra so all required fields (columns) must be grouped together in a single table.</li>
<li>Since each query is backed by a table, data is duplicated across multiple tables in a process known as denormalization. Data duplication and a high write throughput are used to achieve a high read performance.</li>
</ul><h2 id="CQL"><a class="anchor hidden-xs" href="#CQL" title="CQL"><i class="fa fa-link"></i></a>CQL</h2><p>The API for Cassandra is CQL, the Cassandra Query Language. To use CQL, you will need to connect to the cluster, using either:</p><ol>
<li><code>cqlsh</code>, a shell for CQL.</li>
<li>a client driver for Cassandra.
<ul>
<li><a href="https://cassandra.apache.org/doc/latest/cassandra/getting-started/drivers.html" target="_blank" rel="noopener">Here</a> you can find a list of known client drivers for different programming languages. For instance, there is <a href="https://github.com/datastax/python-driver" target="_blank" rel="noopener">DataStax Driver for Apache Cassandra</a> fo Python language.</li>
</ul>
</li>
</ol><h2 id="CQLSH"><a class="anchor hidden-xs" href="#CQLSH" title="CQLSH"><i class="fa fa-link"></i></a>CQLSH</h2><p>cqlsh is a command-line shell for interacting with Cassandra using CQL. It is shipped with every Cassandra package, and can be found in the bin directory alongside the cassandra executable. It connects to the single node specified on the command line. For example, we can access the first node in the cluster as follows:</p><pre><code>docker exec -it cassandra-1 cqlsh
</code></pre><h3 id="Some-cqlsh-commands"><a class="anchor hidden-xs" href="#Some-cqlsh-commands" title="Some-cqlsh-commands"><i class="fa fa-link"></i></a>Some cqlsh commands</h3><ul>
<li>To get help for cqlsh, type HELP or ? to see the list of available commands:</li>
</ul><pre><code class="wrap shell hljs"><span class="hljs-meta">cqlsh&gt;</span><span class="bash"> <span class="hljs-built_in">help</span></span>
</code></pre><ul>
<li>To learn about the current cluster you’re working in, type:</li>
</ul><pre><code class="wrap shell hljs"><span class="hljs-meta">cqlsh&gt;</span><span class="bash"> DESCRIBE CLUSTER;</span>
</code></pre><ul>
<li>To see which keyspaces are available in the cluster, issue the command below.</li>
</ul><pre><code class="wrap shell hljs"><span class="hljs-meta">cqlsh&gt;</span><span class="bash"> DESCRIBE KEYSPACES;</span>
</code></pre><ul>
<li>Learn the client, server, and protocol versions in use</li>
</ul><pre><code class="wrap shell hljs"><span class="hljs-meta">cqlsh&gt;</span><span class="bash"> SHOW VERSION;</span>
</code></pre><h3 id="Some-CRUD-operations"><a class="anchor hidden-xs" href="#Some-CRUD-operations" title="Some-CRUD-operations"><i class="fa fa-link"></i></a>Some CRUD operations</h3><ul>
<li>Create your own keyspace. Try using tab completion as you enter this command</li>
</ul><pre><code class="sql hljs"><span class="hljs-keyword">CREATE</span> KEYSPACE my_keyspace <span class="hljs-keyword">WITH</span> <span class="hljs-keyword">replication</span> = {<span class="hljs-string">'class'</span>: <span class="hljs-string">'SimpleStrategy'</span>, <span class="hljs-string">'replication_factor'</span>: <span class="hljs-number">1</span>};
</code></pre><ul>
<li>Describe the keyspace you just created. What additional information do you notice?</li>
</ul><pre><code class="sql hljs"><span class="hljs-keyword">DESCRIBE</span> KEYSPACE my_keyspace;
</code></pre><ul>
<li>Use the keyspace so you don’t have to enter it on every data manipulation. Note how the prompt changes after you do this.</li>
</ul><pre><code class="sql hljs"><span class="hljs-keyword">USE</span> my_keyspace;
</code></pre><ul>
<li>Create a simple table</li>
</ul><pre><code class="sql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">user</span> ( first_name <span class="hljs-built_in">text</span>, last_name <span class="hljs-built_in">text</span>, PRIMARY <span class="hljs-keyword">KEY</span> (first_name));
</code></pre><ul>
<li>Describe the table you just created. What additional information do you notice?</li>
</ul><pre><code class="sql hljs"><span class="hljs-keyword">DESCRIBE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">user</span>;
</code></pre><ul>
<li>Write some data</li>
</ul><pre><code class="sql hljs"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> <span class="hljs-keyword">user</span> (first_name, last_name) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">'Bill'</span>, <span class="hljs-string">'Nguyen'</span>);
</code></pre><ul>
<li>See how many rows have been written into this table. Notice that row scans are expensive operations on large tables.</li>
</ul><pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">COUNT</span>(*) <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">user</span>;
</code></pre><ul>
<li>Read the data we just wrote</li>
</ul><pre><code class="wrap sql hljs"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">WHERE</span> first_name=<span class="hljs-string">'Bill'</span>;
<span class="hljs-comment">-- Note that the != operator is not supported in CQL SELECT statements.</span>
</code></pre><ul>
<li>Remove a non-primary key column</li>
</ul><pre><code class="sql hljs"><span class="hljs-keyword">DELETE</span> last_name <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">USER</span> <span class="hljs-keyword">WHERE</span> first_name=<span class="hljs-string">'Bill'</span>;
</code></pre><ul>
<li>Check to see the value was removed</li>
</ul><pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">WHERE</span> first_name=<span class="hljs-string">'Bill'</span>;
</code></pre><ul>
<li>Delete an entire row</li>
</ul><pre><code class="sql hljs"><span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">USER</span> <span class="hljs-keyword">WHERE</span> first_name=<span class="hljs-string">'Bill'</span>;
</code></pre><ul>
<li>Check to make sure it was removed</li>
</ul><pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">WHERE</span> first_name=<span class="hljs-string">'Bill'</span>;
</code></pre><ul>
<li>Add a column to the table</li>
</ul><pre><code class="sql hljs"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">ADD</span> title <span class="hljs-built_in">text</span>;
</code></pre><ul>
<li>Check to see that the column was added</li>
</ul><pre><code class="sql hljs"><span class="hljs-keyword">DESCRIBE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">user</span>;
</code></pre><ul>
<li>Write a couple of rows, populate different columns for each, and view the results.</li>
</ul><pre><code class="sql hljs"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> <span class="hljs-keyword">user</span> (first_name, last_name, title) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">'Bill'</span>, <span class="hljs-string">'Nguyen'</span>, <span class="hljs-string">'Mr.'</span>);
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> <span class="hljs-keyword">user</span> (first_name, last_name) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">'Mary'</span>, <span class="hljs-string">'Rodriguez'</span>);
<span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">user</span>;
</code></pre><ul>
<li>View the table data.</li>
</ul><pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> first_name <span class="hljs-keyword">AS</span> fname, last_name <span class="hljs-keyword">AS</span> lname <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">LIMIT</span> <span class="hljs-number">1</span>;
</code></pre><ul>
<li>To output selected data from a table in JSON format, use the JSON function:</li>
</ul><pre><code class="wrap sql hljs"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">JSON</span> * <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">user</span>;
<span class="hljs-keyword">SELECT</span> first_name, toJson(last_name) <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">user</span>;
</code></pre><ul>
<li>To cast a column to a different data type, use the <code>CAST</code> function.</li>
</ul><pre><code class="sql hljs"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">ADD</span> <span class="hljs-keyword">id</span> <span class="hljs-keyword">uuid</span>;
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">ADD</span> <span class="hljs-built_in">date</span> <span class="hljs-built_in">date</span>;
<span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">SET</span> <span class="hljs-built_in">date</span>=<span class="hljs-keyword">CAST</span>(<span class="hljs-string">'1994-01-20'</span> <span class="hljs-keyword">AS</span> <span class="hljs-built_in">date</span>) <span class="hljs-keyword">WHERE</span> first_name=<span class="hljs-string">'Bill'</span>;
<span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">SET</span> <span class="hljs-built_in">date</span>=<span class="hljs-keyword">CAST</span>(<span class="hljs-string">'2000-05-30'</span> <span class="hljs-keyword">AS</span> <span class="hljs-built_in">date</span>) <span class="hljs-keyword">WHERE</span> first_name=<span class="hljs-string">'Mary'</span>;
<span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">SET</span> <span class="hljs-keyword">id</span>=<span class="hljs-keyword">uuid</span>() <span class="hljs-keyword">WHERE</span> first_name=<span class="hljs-string">'Bill'</span>;
<span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">SET</span> <span class="hljs-keyword">id</span>=<span class="hljs-keyword">uuid</span>() <span class="hljs-keyword">WHERE</span> first_name=<span class="hljs-string">'Mary'</span>;
</code></pre><ul>
<li>If a table has duplicate values in a column, use the DISTINCT function to return only the unique values: (can be used only for partition keys and static keys)</li>
</ul><pre><code class="wrap sql hljs"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> <span class="hljs-keyword">user</span> (first_name, last_name) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">'Mary'</span>, <span class="hljs-string">'James'</span>);
<span class="hljs-comment"># the previous statement will override the row identified by Mary since the partition key is first_name.</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> first_name <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">user</span>;
</code></pre><ul>
<li>Use some aggregation functions.</li>
</ul><pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> first_name, <span class="hljs-keyword">MAX</span>(<span class="hljs-built_in">date</span>), <span class="hljs-keyword">COUNT</span>(*) <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">user</span>;
<span class="hljs-comment"># WHERE first_name='Mary'</span>
</code></pre><ul>
<li>View the timestamps generated for previous writes</li>
</ul><pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> first_name <span class="hljs-keyword">AS</span> fname, last_name <span class="hljs-keyword">AS</span> lname, writetime(last_name) <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">LIMIT</span> <span class="hljs-number">1</span>;
</code></pre><ul>
<li>Note that we are not allowed to ask for the timestamp on primary key columns</li>
</ul><pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> WRITETIME(first_name) <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">user</span>;
</code></pre><ul>
<li>The TTL function returns the time to live of a column. This function is useful when using Time to Live (TTL) to expire data in a table. If a TTL is set on a column, the data is automatically deleted after the specified time has elapsed.</li>
</ul><pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> TTL(last_name) <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">user</span>;
</code></pre><ul>
<li>Empty the contents of the table</li>
</ul><pre><code class="sql hljs"><span class="hljs-keyword">TRUNCATE</span> <span class="hljs-keyword">user</span>;
</code></pre><ul>
<li>Show that the table is empty</li>
</ul><pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">user</span>;
</code></pre><ul>
<li>Remove the entire table</li>
</ul><pre><code class="sql hljs"><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">user</span>;
</code></pre><ul>
<li>Clear the screen of output from previous commands</li>
</ul><pre><code class="sql hljs">CLEAR
</code></pre><ul>
<li>Exit cqlsh</li>
</ul><pre><code class="sql hljs">EXIT
</code></pre><div class="alert alert-info">
<p>Try all statments above with tracing on and see how the connection happens between cluster nodes.</p>
<pre><code class="sql hljs">TRACING ON;
</code></pre>
</div><h3 id="Collections-in-CQL"><a class="anchor hidden-xs" href="#Collections-in-CQL" title="Collections-in-CQL"><i class="fa fa-link"></i></a>Collections in CQL</h3><pre><code class="sql hljs"><span class="hljs-comment"># Create the keyspace and table</span>
<span class="hljs-keyword">CREATE</span> KEYSPACE <span class="hljs-keyword">IF</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> my_keyspace <span class="hljs-keyword">WITH</span> <span class="hljs-keyword">replication</span> = {<span class="hljs-string">'class'</span>: <span class="hljs-string">'SimpleStrategy'</span>, <span class="hljs-string">'replication_factor'</span>: <span class="hljs-number">3</span>} ;
<span class="hljs-keyword">USE</span> my_keyspace;
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> <span class="hljs-keyword">user</span> ( first_name <span class="hljs-built_in">text</span>, last_name <span class="hljs-built_in">text</span>, title <span class="hljs-built_in">text</span>, PRIMARY <span class="hljs-keyword">KEY</span> (first_name));

<span class="hljs-comment"># insert some data</span>
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> <span class="hljs-keyword">user</span> (first_name, last_name, title) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">'Bill'</span>, <span class="hljs-string">'Nguyen'</span>, <span class="hljs-string">'Mr.'</span>) <span class="hljs-keyword">IF</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span>;
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> <span class="hljs-keyword">user</span> (first_name, last_name) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">'Mary'</span>, <span class="hljs-string">'Rodriguez'</span>) <span class="hljs-keyword">IF</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span>;


<span class="hljs-comment"># Define emails as set</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">ADD</span> emails <span class="hljs-keyword">set</span>&lt;<span class="hljs-built_in">text</span>&gt;;

<span class="hljs-comment"># add some emails</span>
<span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">SET</span> emails = { <span class="hljs-string">'mary@example.com'</span> } <span class="hljs-keyword">WHERE</span> first_name = <span class="hljs-string">'Mary'</span>;

<span class="hljs-comment"># View the table</span>
<span class="hljs-keyword">SELECT</span> emails <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">WHERE</span> first_name = <span class="hljs-string">'Mary'</span>;

<span class="hljs-comment"># Add another email address using concatenation</span>
<span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">SET</span> emails = emails + {<span class="hljs-string">'mary.mcdonald.AZ@gmail.com'</span> } <span class="hljs-keyword">WHERE</span> first_name = <span class="hljs-string">'Mary'</span>;
<span class="hljs-keyword">SELECT</span> emails <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">WHERE</span> first_name = <span class="hljs-string">'Mary'</span>;


<span class="hljs-comment"># Define phone numbers as list</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">ADD</span> phone_numbers <span class="hljs-keyword">list</span>&lt;<span class="hljs-built_in">text</span>&gt;;

<span class="hljs-comment"># Add a phone number for Mary and check that it was added successfully</span>
<span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">SET</span> phone_numbers = [ <span class="hljs-string">'1-800-999-9999'</span> ] <span class="hljs-keyword">WHERE</span> first_name = <span class="hljs-string">'Mary'</span>;
<span class="hljs-keyword">SELECT</span> phone_numbers <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">WHERE</span> first_name = <span class="hljs-string">'Mary'</span>;


<span class="hljs-comment"># Add a second number by appending it:</span>
<span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">SET</span> phone_numbers = phone_numbers + [ <span class="hljs-string">'480-111-1111'</span> ] <span class="hljs-keyword">WHERE</span> first_name = <span class="hljs-string">'Mary'</span>;
<span class="hljs-keyword">SELECT</span> phone_numbers <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">WHERE</span> first_name = <span class="hljs-string">'Mary'</span>;


<span class="hljs-comment"># Replace an individual item in the list referenced by its index</span>
<span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">SET</span> phone_numbers[<span class="hljs-number">1</span>] = <span class="hljs-string">'480-111-1111'</span> <span class="hljs-keyword">WHERE</span> first_name = <span class="hljs-string">'Mary'</span>;


<span class="hljs-comment"># Use the subtraction operator to remove a list item matching a specified value</span>
<span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">SET</span> phone_numbers = phone_numbers - [ <span class="hljs-string">'480-111-1111'</span> ] <span class="hljs-keyword">WHERE</span> first_name = <span class="hljs-string">'Mary'</span>;

<span class="hljs-comment"># Delete a specific item directly using its index</span>
<span class="hljs-keyword">DELETE</span> phone_numbers[<span class="hljs-number">0</span>] <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">WHERE</span> first_name = <span class="hljs-string">'Mary'</span>;

<span class="hljs-comment"># Add a map attribute to store information about user logins (timed in seconds) keyed by a timestamp (timeuuid)</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">ADD</span> login_sessions <span class="hljs-keyword">map</span>&lt;timeuuid, <span class="hljs-built_in">int</span>&gt;;

<span class="hljs-comment"># Add a couple of login sessions for Mary and see the results</span>
<span class="hljs-comment"># Use the now() function to allow Cassandra to set the timestamp</span>
<span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">SET</span> login_sessions = { <span class="hljs-keyword">now</span>(): <span class="hljs-number">13</span>, <span class="hljs-keyword">now</span>(): <span class="hljs-number">18</span>} <span class="hljs-keyword">WHERE</span> first_name = <span class="hljs-string">'Mary'</span>;
<span class="hljs-keyword">SELECT</span> login_sessions <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">WHERE</span> first_name = <span class="hljs-string">'Mary'</span>;


<span class="hljs-comment"># Indexes</span>
<span class="hljs-comment"># Query based on a non-primary key column</span>
<span class="hljs-comment"># Why doesn't this work?</span>
<span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">WHERE</span> last_name = <span class="hljs-string">'Nguyen'</span>;

<span class="hljs-comment"># Create a secondary index for the last_name column.</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">INDEX</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">user</span> ( last_name );

<span class="hljs-comment"># Now try the query again</span>
<span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">WHERE</span> last_name = <span class="hljs-string">'Nguyen'</span>;


<span class="hljs-comment"># Create indexes on other attributes if desired, even collections</span>
<span class="hljs-comment"># Note that queries based on indexes are typically more expensive, as they involve talking to more nodes</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">INDEX</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">user</span> ( addresses );
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">INDEX</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">user</span> ( emails );
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">INDEX</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">user</span> ( phone_numbers );

<span class="hljs-comment"># Drop indexes we no longer want maintained</span>
<span class="hljs-keyword">DROP</span> <span class="hljs-keyword">INDEX</span> user_last_name_idx;
<span class="hljs-keyword">DROP</span> <span class="hljs-keyword">INDEX</span> user_addresses_idx;
<span class="hljs-keyword">DROP</span> <span class="hljs-keyword">INDEX</span> user_emails_idx;
<span class="hljs-keyword">DROP</span> <span class="hljs-keyword">INDEX</span> user_phone_numbers_idx;

<span class="hljs-comment"># Create a SSTable Attached Secondary Index (SASI), which is a more performant index implementation</span>
<span class="hljs-keyword">CREATE</span> CUSTOM <span class="hljs-keyword">INDEX</span> user_last_name_sasi_idx <span class="hljs-keyword">ON</span> <span class="hljs-keyword">user</span> (last_name) <span class="hljs-keyword">USING</span> <span class="hljs-string">'org.apache.cassandra.index.sasi.SASIIndex'</span>;

<span class="hljs-comment"># SASI indexes allow us to perform inequality and text searches such as "like" searches</span>
<span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">WHERE</span> last_name <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'N%'</span>;
</code></pre><h3 id="Conditional-queries"><a class="anchor hidden-xs" href="#Conditional-queries" title="Conditional-queries"><i class="fa fa-link"></i></a>Conditional queries</h3><p>The <code>WHERE</code> clause is used to filter the rows that are returned. Using <code>WHERE</code>, you can specify a condition that must be met for a row to be included in the result set. The condition can include multiple columns and multiple conditions linked with <code>AND</code>. A subtle variation to the use of <code>AND</code> is using a tuple to group columns to meet a condition.</p><p>everal arithmetic and non-arithmetic operators are used in the <code>WHERE</code> clause to specify the condition.<br>
<img src="https://i.imgur.com/IhKUvb6.png" alt="" class="md-image md-image"></p><div class="alert alert-warning">
<p>Some facts about the <code>WHERE</code> and <code>ORDER BY</code> clauses:</p>
<ul>
<li>The partition keys always use <code>=</code> operator.</li>
</ul>
<pre><code class="wrap sql hljs"><span class="hljs-keyword">SELECT</span> first_name <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">WHERE</span> first_name=<span class="hljs-string">'Bill'</span>;
</code></pre>
<ul>
<li>Last partition keys and all clustering columns can use <code>IN</code> operator.</li>
</ul>
<pre><code class="wrap sql hljs"><span class="hljs-keyword">SELECT</span> first_name <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">WHERE</span> first_name <span class="hljs-keyword">IN</span> (<span class="hljs-string">'Bill'</span>, <span class="hljs-string">'Mary'</span>);
</code></pre>
<ul>
<li><code>ORDER BY</code> can be applied only on clustered columns and is only supported when the partition key is restricted by an EQ or an IN in <code>WHERE</code> clause.</li>
</ul>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> first_name <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">WHERE</span> first_name <span class="hljs-keyword">IN</span> (<span class="hljs-string">'Bill'</span>, <span class="hljs-string">'Mary'</span>);
</code></pre>
</div><h3 id="Clustering-columns"><a class="anchor hidden-xs" href="#Clustering-columns" title="Clustering-columns"><i class="fa fa-link"></i></a>Clustering columns</h3><p>The clustering columns are used to <strong>sort</strong> the data within a partition, and the data is <strong>stored</strong> in the sorted order. This quality means that slices, where a range of rows are retrieved, can be very efficient. A particular row can be found using the clustering columns in the order that they are defined in the primary key. The rows that come before or after that row can be retrieved quickly. In fact, even a slice of a slice can be retrieved, by narrowing down the range of rows with conditions on the first clustering columns. A tuple can be handy for sorting on multiple clustering columns.</p><p>Because the database uses the clustering columns to determine the location of the data on the partition, you must identify the higher level clustering columns definitively using the equals (=) or <code>IN</code> operators. In a query, you can only restrict the lowest level using the range operators (&gt;, &gt;=, &lt;, or &lt;=).</p><p>When a query contains no restrictions on clustering or index columns, all the data from the partition is returned.</p><h4 id="How-order-impacts-clustering-restrictions"><a class="anchor hidden-xs" href="#How-order-impacts-clustering-restrictions" title="How-order-impacts-clustering-restrictions"><i class="fa fa-link"></i></a>How order impacts clustering restrictions</h4><p>Because the database uses the clustering columns to determine the location of the data on the partition, you must identify the higher level clustering columns definitively using the equals (=) or IN operators. In a query, you can only restrict the lowest level using the range operators (&gt;, &gt;=, &lt;, or &lt;=).</p><p>The following table is used to illustrate how clustering works:</p><pre><code class="sql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> my_keyspace.numbers (
   <span class="hljs-keyword">key</span> <span class="hljs-built_in">int</span>,
   col_1 <span class="hljs-built_in">int</span>,
   col_2 <span class="hljs-built_in">int</span>,
   col_3 <span class="hljs-built_in">int</span>,
   col_4 <span class="hljs-built_in">int</span>,
   PRIMARY <span class="hljs-keyword">KEY</span> ((<span class="hljs-keyword">key</span>), col_1, col_2, col_3, col_4)
);
</code></pre><p>The database stores and locates the data using a nested sort order. The data is stored in hierarchy that the query must traverse:</p><p>To avoid full scans of the partition and to make queries more efficient, the database requires that the higher level columns in the sort order (col_1, col_2, and col_3) are identified using the equals or IN operators. Ranges are allowed on the last column (col_4). For example, to find only values in column 4 that are less than or equal to 2:</p><pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> my_keyspace.numbers
  <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">key</span> = <span class="hljs-number">100</span> <span class="hljs-keyword">AND</span> col_1 = <span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> col_2 = <span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> col_3 = <span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> col_4 &lt;= <span class="hljs-number">2</span>;
</code></pre><p>The IN operator can impact performance on medium-large datasets. When selecting multiple segments, the database loads and filters all the specified segments. For example, to find all values less than or equal to 2 in both col_1 segments 1 and 2:</p><pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> my_keyspace.numbers <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">key</span> = <span class="hljs-number">100</span> <span class="hljs-keyword">AND</span> col_1 = <span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> col_2 &gt; <span class="hljs-number">1</span>
</code></pre><p>You can see below how the data are stored.<br>
<img src="https://docs.datastax.com/en/cql/hcd/develop/_images/cqlQueryClusteringColumnSegments.png" alt="" class="md-image md-image"></p><h4 id="Invalid-restrictions"><a class="anchor hidden-xs" href="#Invalid-restrictions" title="Invalid-restrictions"><i class="fa fa-link"></i></a>Invalid restrictions</h4><p>Queries that attempt to return ranges without identifying any of the higher level segments are rejected:</p><pre><code class="wrap sql hljs"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> my_keyspace.numbers <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">key</span> = <span class="hljs-number">100</span> <span class="hljs-keyword">AND</span> col_4 &lt;= <span class="hljs-number">2</span>;

<span class="hljs-comment">-- InvalidRequest: Error from server: code=2200 [Invalid query] message="PRIMARY KEY column "col_4" cannot be restricted as preceding column "col_1" is not restricted"</span>
</code></pre><div class="alert alert-warning">
<p>You can force the query using the ALLOW FILTERING option; however, this loads the entire partition and negatively impacts performance by causing long READ latencies.</p>
<p>By default, CQL only allows select queries that don’t involve a full scan of all partitions. If all partitions are scanned, then returning the results may experience a significant latency proportional to the amount of data in the table. The ALLOW FILTERING option explicitly executes a full scan. Thus, the performance of the query can be unpredictable.</p>
</div><h4 id="Only-restricting-top-level-clustering-columns"><a class="anchor hidden-xs" href="#Only-restricting-top-level-clustering-columns" title="Only-restricting-top-level-clustering-columns"><i class="fa fa-link"></i></a>Only restricting top level clustering columns</h4><pre><code class="wrap sql hljs"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> my_keyspace.numbers <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">key</span> = <span class="hljs-number">100</span> <span class="hljs-keyword">AND</span> col_1 = <span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> col_2 &gt; <span class="hljs-number">1</span>
</code></pre><h4 id="Returning-ranges-that-span-clustering-segments"><a class="anchor hidden-xs" href="#Returning-ranges-that-span-clustering-segments" title="Returning-ranges-that-span-clustering-segments"><i class="fa fa-link"></i></a>Returning ranges that span clustering segments</h4><pre><code class="wrap sql hljs"><span class="hljs-comment"># Slices across full partition</span>
<span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> cycling.numbers
  <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">key</span> = <span class="hljs-number">100</span> <span class="hljs-keyword">AND</span> (col_1, col_2, col_3, col_4) &lt;= (<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>);
</code></pre><p><img src="https://docs.datastax.com/en/cql/hcd/develop/_images/cqlQuerySlicePartition1.png" alt="" class="md-image md-image"></p><pre><code class="wrap sql hljs"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> cycling.numbers
  <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">key</span> = <span class="hljs-number">100</span> <span class="hljs-keyword">AND</span> (col_1, col_2, col_3, col_4) &lt;= (<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">4</span>);
</code></pre><p><img src="https://docs.datastax.com/en/cql/hcd/develop/_images/cqlQuerySlicePartition2.png" alt="" class="md-image md-image"></p><h4 id="Slices-of-clustering-segments"><a class="anchor hidden-xs" href="#Slices-of-clustering-segments" title="Slices-of-clustering-segments"><i class="fa fa-link"></i></a>Slices of clustering segments</h4><pre><code class="wrap sql hljs"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> cycling.numbers <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">key</span> = <span class="hljs-number">100</span> <span class="hljs-keyword">AND</span> col_1 = <span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> col_2 = <span class="hljs-number">1</span>
  <span class="hljs-keyword">AND</span> (col_3, col_4) &gt;= (<span class="hljs-number">1</span>, <span class="hljs-number">2</span>) <span class="hljs-keyword">AND</span> (col_3, col_4) &lt; (<span class="hljs-number">2</span>, <span class="hljs-number">3</span>);
</code></pre><p><img src="https://docs.datastax.com/en/cql/hcd/develop/_images/cqlQuerySliceClusteringSegments.png" alt="" class="md-image md-image"></p><pre><code class="wrap sql hljs"><span class="hljs-comment"># Invalid queries</span>

<span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> cycling.numbers <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">key</span> = <span class="hljs-number">100</span> <span class="hljs-keyword">AND</span> col_1 = <span class="hljs-number">1</span>
  <span class="hljs-keyword">AND</span> (col_2, col_3, col_4) &gt;= (<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>)  <span class="hljs-keyword">AND</span> (col_3, col_4) &lt; (<span class="hljs-number">2</span>, <span class="hljs-number">3</span>);
</code></pre><h3 id="Group-by-clause"><a class="anchor hidden-xs" href="#Group-by-clause" title="Group-by-clause"><i class="fa fa-link"></i></a>Group by clause</h3><p>Either one or more primary key columns or a deterministic function or aggregate can be used in the GROUP BY clause.</p><h2 id="Example-on-Cassandra-database"><a class="anchor hidden-xs" href="#Example-on-Cassandra-database" title="Example-on-Cassandra-database"><i class="fa fa-link"></i></a>Example on Cassandra database</h2><p>Let’s create a simple domain model that is easy to understand in the relational world, and then see how we might map it from a relational to a distributed model in Cassandra. The domain is making hotel reservations.</p><p>The conceptual domain includes hotels, guests that stay in the hotels, a collection of rooms for each hotel, the rates and availability of those rooms, and a record of reservations booked for guests. Hotels typically also maintain a collection of “points of interest,” which are parks, museums, shopping galleries, monuments, or other places near the hotel that guests might want to visit during their stay. Both hotels and points of interest need to maintain geolocation data so that they can be found on maps for mashups, and to calculate distances.<br>
The conceptual domain is depicted below using the entity–relationship model.<br>
<img src="https://cassandra.apache.org/doc/stable/cassandra/_images/data_modeling_hotel_erd.png" alt="" class="md-image md-image"></p><p>The ER-diagram consists of entities, relationships and attributes. This conceptual domain can be modeled in relational databases as tables and relationships (using foreign keys) as shown below.<br>
<img src="https://cassandra.apache.org/doc/stable/cassandra/_images/data_modeling_hotel_relational.png" alt="" class="md-image md-image"></p><p><em>Cassandra also stores the data in tables but there are no joins between the tables and the tables are denormalized. Tables have query-first design.</em></p><p>The queries in the relational world are very much secondary. It is assumed that you can always get the data you want as long as you have your tables modeled properly. Even if you have to use several complex subqueries or join statements, this is usually true.</p><p>By contrast, in Cassandra you don’t start with the data model; you start with the <strong>query model</strong>. Instead of modeling the data first and then writing queries, with Cassandra you model the queries and let the data be organized around them. Think of the most common query paths your application will use, and then create the tables that you need to support them.</p><div class="alert alert-info">
<p><strong>Sorting</strong> is a design decision in Cassandra where the CQL <code>SELECT</code> statement  does not support <code>ORDER BY</code>. The sort order available on queries is fixed, and is determined entirely by the selection of clustering columns you supply in the <code>CREATE TABLE</code> command.</p>
</div><p>Here we present the steps to create Cassandra database for the application  making hotel reservations.</p><h3 id="Define-application-queries"><a class="anchor hidden-xs" href="#Define-application-queries" title="Define-application-queries"><i class="fa fa-link"></i></a>Define application queries</h3><p>We need to understand the application requirements and data workflow in the application to define the required queries. While we design queries, we need to know where the data comes from for each query. This should be taken into consideration when following query-first design approach. Under this consideration, we eneded up with the following queries in this order:</p><pre><code class="wrap hljs">Q1. Find hotels near a given point of interest.
Q2. Find information about a given hotel, such as its name and location.
Q3. Find points of interest near a given hotel.
Q6. Lookup a reservation by confirmation number.
Q7. Lookup a reservation by hotel, date, and guest name.
Q8. Lookup all reservations by guest name.
Q9. View guest details.
</code></pre><p>All of the queries are shown in the context of the workflow of the application in the figure below. Each box on the diagram represents a step in the application workflow, with arrows indicating the flows between steps and the associated query. If you’ve modeled the application well, each step of the workflow accomplishes a task that “unlocks” subsequent steps.  For example, the “View hotels near POI” task helps the application learn about several hotels, including their unique keys. The key for a selected hotel may be used as part of Q2, in order to obtain detailed description of the hotel.</p><p><img src="https://cassandra.apache.org/doc/stable/cassandra/_images/data_modeling_hotel_queries.png" alt="" class="md-image md-image"></p><h3 id="Define-logical-data-model"><a class="anchor hidden-xs" href="#Define-logical-data-model" title="Define-logical-data-model"><i class="fa fa-link"></i></a>Define logical data model</h3><p>Now that you have defined your queries, you’re ready to begin designing Cassandra tables. Follow the steps below:</p><ol>
<li>Create a logical model containing a table for each query, capturing entities and relationships from the conceptual model.</li>
<li>Name the tables</li>
<li>Identify the primary and partition keys for the tables</li>
<li>Create Chebotko diagrams.</li>
</ol><p><img src="https://cassandra.apache.org/doc/stable/cassandra/_images/data_modeling_chebotko_logical.png" alt="" class="md-image md-image"></p><p>Each table is shown with its title and a list of columns. Primary key columns are identified via symbols such as K for partition key columns and C↑ or C↓ to represent clustering columns. Lines are shown entering tables or between tables to indicate the queries that each table is designed to support.</p><p>The figure below shows a Chebotko logical data model for the queries involving hotels, points of interest, rooms, and amenities. One thing you’ll notice immediately is that the Cassandra design doesn’t include dedicated tables for rooms or amenities, as you had in the relational design. This is because the workflow didn’t identify any queries requiring this direct access.</p><h4 id="Hotel-Logical-Data-Model"><a class="anchor hidden-xs" href="#Hotel-Logical-Data-Model" title="Hotel-Logical-Data-Model"><i class="fa fa-link"></i></a>Hotel Logical Data Model</h4><p><img src="https://cassandra.apache.org/doc/stable/cassandra/_images/data_modeling_hotel_logical.png" alt="" class="md-image md-image"></p><h4 id="Reservation-Logical-Data-Model"><a class="anchor hidden-xs" href="#Reservation-Logical-Data-Model" title="Reservation-Logical-Data-Model"><i class="fa fa-link"></i></a>Reservation Logical Data Model</h4><p><img src="https://cassandra.apache.org/doc/stable/cassandra/_images/data_modeling_reservation_logical.png" alt="" class="md-image md-image"></p><h3 id="Physical-data-modeling"><a class="anchor hidden-xs" href="#Physical-data-modeling" title="Physical-data-modeling"><i class="fa fa-link"></i></a>Physical data modeling</h3><p>Here we need to specify the data types for columns and add attributes to them.</p><p><img src="https://cassandra.apache.org/doc/stable/cassandra/_images/data_modeling_chebotko_physical.png" alt="" class="md-image md-image"></p><h4 id="Hotel-Physical-Data-Model"><a class="anchor hidden-xs" href="#Hotel-Physical-Data-Model" title="Hotel-Physical-Data-Model"><i class="fa fa-link"></i></a>Hotel Physical Data Model</h4><p><img src="https://cassandra.apache.org/doc/stable/cassandra/_images/data_modeling_hotel_physical.png" alt="" class="md-image md-image"></p><h3 id="Create-the-database-objects"><a class="anchor hidden-xs" href="#Create-the-database-objects" title="Create-the-database-objects"><i class="fa fa-link"></i></a>Create the database objects</h3><p>You can save these statements in a file <code>hotel.cql</code> to execute it in the next section.</p><ol>
<li>Create Hotel keyspace.</li>
</ol><pre><code class="sql hljs"><span class="hljs-keyword">CREATE</span> KEYSPACE hotel <span class="hljs-keyword">WITH</span> <span class="hljs-keyword">replication</span> = {<span class="hljs-string">'class'</span>: <span class="hljs-string">'SimpleStrategy'</span>, <span class="hljs-string">'replication_factor'</span> : <span class="hljs-number">3</span>};
</code></pre><ol start="2">
<li>Create tables.</li>
</ol><pre><code class="wrap sql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TYPE</span> hotel.address (
    street <span class="hljs-built_in">text</span>,
    city <span class="hljs-built_in">text</span>,
    state_or_province <span class="hljs-built_in">text</span>,
    postal_code <span class="hljs-built_in">text</span>,
    country <span class="hljs-built_in">text</span>
);

<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> hotel.hotels_by_poi (
    poi_name <span class="hljs-built_in">text</span>,
    hotel_id <span class="hljs-built_in">text</span>,
    <span class="hljs-keyword">name</span> <span class="hljs-built_in">text</span>,
    phone <span class="hljs-built_in">text</span>,
    address frozen&lt;address&gt;, <span class="hljs-comment">-- A frozen value serializes multiple components into a single value. Non-frozen types allow updates to individual fields.</span>
    PRIMARY <span class="hljs-keyword">KEY</span> ((poi_name), hotel_id)
) <span class="hljs-keyword">WITH</span> <span class="hljs-keyword">comment</span> = <span class="hljs-string">'Q1. Find hotels near given poi'</span>
<span class="hljs-keyword">AND</span> <span class="hljs-keyword">CLUSTERING</span> <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> (hotel_id <span class="hljs-keyword">ASC</span>) ;



<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> hotel.hotels (
    <span class="hljs-keyword">id</span> <span class="hljs-built_in">text</span> PRIMARY <span class="hljs-keyword">KEY</span>,
    <span class="hljs-keyword">name</span> <span class="hljs-built_in">text</span>,
    phone <span class="hljs-built_in">text</span>,
    address frozen&lt;address&gt;,
    pois <span class="hljs-keyword">set</span>&lt;<span class="hljs-built_in">text</span>&gt; <span class="hljs-comment">-- a collection</span>
) <span class="hljs-keyword">WITH</span> <span class="hljs-keyword">comment</span> = <span class="hljs-string">'Q2. Find information about a hotel'</span>;

<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> hotel.pois_by_hotel (
    poi_name <span class="hljs-built_in">text</span>,
    hotel_id <span class="hljs-built_in">text</span>,
    description <span class="hljs-built_in">text</span>,
    PRIMARY <span class="hljs-keyword">KEY</span> ((hotel_id), poi_name)
) <span class="hljs-keyword">WITH</span> <span class="hljs-keyword">comment</span> = <span class="hljs-string">'Q3. Find pois near a hotel'</span>;

<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> hotel.available_rooms_by_hotel_date (
    hotel_id <span class="hljs-built_in">text</span>,
    <span class="hljs-built_in">date</span> <span class="hljs-built_in">date</span>,
    room_number <span class="hljs-built_in">smallint</span>,
    is_available <span class="hljs-built_in">boolean</span>,
    PRIMARY <span class="hljs-keyword">KEY</span> ((hotel_id), <span class="hljs-built_in">date</span>, room_number)
) <span class="hljs-keyword">WITH</span> <span class="hljs-keyword">comment</span> = <span class="hljs-string">'Q4. Find available rooms by hotel / date'</span>;

<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> hotel.amenities_by_room (
    hotel_id <span class="hljs-built_in">text</span>,
    room_number <span class="hljs-built_in">smallint</span>,
    amenity_name <span class="hljs-built_in">text</span>,
    description <span class="hljs-built_in">text</span>,
    PRIMARY <span class="hljs-keyword">KEY</span> ((hotel_id, room_number), amenity_name)
) <span class="hljs-keyword">WITH</span> <span class="hljs-keyword">comment</span> = <span class="hljs-string">'Q5. Find amenities for a room'</span>;
</code></pre><h3 id="Populate-data-from-csv-file"><a class="anchor hidden-xs" href="#Populate-data-from-csv-file" title="Populate-data-from-csv-file"><i class="fa fa-link"></i></a>Populate data from csv file</h3><p>Here we will run some queries on data populated from an external datset file. Given the following <code>data.csv</code> csv file.</p><pre><code class="csv hljs">hotel_id,date,room_number,is_available
AZ123,<span class="hljs-number">2016</span><span class="hljs-number">-01</span><span class="hljs-number">-01</span>,<span class="hljs-number">101</span>,<span class="hljs-literal">TRUE</span>
AZ123,<span class="hljs-number">2016</span><span class="hljs-number">-01</span><span class="hljs-number">-02</span>,<span class="hljs-number">101</span>,<span class="hljs-literal">TRUE</span>
AZ123,<span class="hljs-number">2016</span><span class="hljs-number">-01</span><span class="hljs-number">-21</span>,<span class="hljs-number">101</span>,<span class="hljs-literal">TRUE</span>
AZ123,<span class="hljs-number">2016</span><span class="hljs-number">-01</span><span class="hljs-number">-01</span>,<span class="hljs-number">102</span>,<span class="hljs-literal">TRUE</span>
AZ123,<span class="hljs-number">2016</span><span class="hljs-number">-01</span><span class="hljs-number">-04</span>,<span class="hljs-number">102</span>,<span class="hljs-literal">TRUE</span>
AZ123,<span class="hljs-number">2016</span><span class="hljs-number">-01</span><span class="hljs-number">-05</span>,<span class="hljs-number">102</span>,<span class="hljs-literal">TRUE</span>
AZ123,<span class="hljs-number">2016</span><span class="hljs-number">-01</span><span class="hljs-number">-06</span>,<span class="hljs-number">102</span>,<span class="hljs-literal">TRUE</span>
AZ123,<span class="hljs-number">2016</span><span class="hljs-number">-01</span><span class="hljs-number">-07</span>,<span class="hljs-number">102</span>,<span class="hljs-literal">TRUE</span>
AZ123,<span class="hljs-number">2016</span><span class="hljs-number">-01</span><span class="hljs-number">-08</span>,<span class="hljs-number">102</span>,<span class="hljs-literal">TRUE</span>
AZ123,<span class="hljs-number">2016</span><span class="hljs-number">-01</span><span class="hljs-number">-09</span>,<span class="hljs-number">102</span>,<span class="hljs-literal">TRUE</span>
AZ123,<span class="hljs-number">2016</span><span class="hljs-number">-01</span><span class="hljs-number">-10</span>,<span class="hljs-number">102</span>,<span class="hljs-literal">TRUE</span>
AZ123,<span class="hljs-number">2016</span><span class="hljs-number">-01</span><span class="hljs-number">-11</span>,<span class="hljs-number">102</span>,<span class="hljs-literal">TRUE</span>
AZ123,<span class="hljs-number">2016</span><span class="hljs-number">-01</span><span class="hljs-number">-30</span>,<span class="hljs-number">102</span>,<span class="hljs-literal">TRUE</span>
AZ123,<span class="hljs-number">2016</span><span class="hljs-number">-01</span><span class="hljs-number">-31</span>,<span class="hljs-number">102</span>,<span class="hljs-literal">TRUE</span>
AZ123,<span class="hljs-number">2016</span><span class="hljs-number">-01</span><span class="hljs-number">-01</span>,<span class="hljs-number">103</span>,<span class="hljs-literal">TRUE</span>
AZ123,<span class="hljs-number">2016</span><span class="hljs-number">-01</span><span class="hljs-number">-16</span>,<span class="hljs-number">103</span>,<span class="hljs-literal">TRUE</span>
AZ123,<span class="hljs-number">2016</span><span class="hljs-number">-01</span><span class="hljs-number">-17</span>,<span class="hljs-number">103</span>,<span class="hljs-literal">TRUE</span>
AZ123,<span class="hljs-number">2016</span><span class="hljs-number">-01</span><span class="hljs-number">-18</span>,<span class="hljs-number">103</span>,<span class="hljs-literal">TRUE</span>
AZ123,<span class="hljs-number">2016</span><span class="hljs-number">-01</span><span class="hljs-number">-19</span>,<span class="hljs-number">103</span>,<span class="hljs-literal">TRUE</span>
AZ123,<span class="hljs-number">2016</span><span class="hljs-number">-01</span><span class="hljs-number">-29</span>,<span class="hljs-number">103</span>,<span class="hljs-literal">TRUE</span>
AZ123,<span class="hljs-number">2016</span><span class="hljs-number">-01</span><span class="hljs-number">-30</span>,<span class="hljs-number">103</span>,<span class="hljs-literal">TRUE</span>
AZ123,<span class="hljs-number">2016</span><span class="hljs-number">-01</span><span class="hljs-number">-31</span>,<span class="hljs-number">103</span>,<span class="hljs-literal">TRUE</span>
AZ123,<span class="hljs-number">2016</span><span class="hljs-number">-01</span><span class="hljs-number">-01</span>,<span class="hljs-number">104</span>,<span class="hljs-literal">TRUE</span>
AZ123,<span class="hljs-number">2016</span><span class="hljs-number">-01</span><span class="hljs-number">-02</span>,<span class="hljs-number">104</span>,<span class="hljs-literal">TRUE</span>
AZ123,<span class="hljs-number">2016</span><span class="hljs-number">-01</span><span class="hljs-number">-09</span>,<span class="hljs-number">104</span>,<span class="hljs-literal">TRUE</span>
AZ123,<span class="hljs-number">2016</span><span class="hljs-number">-01</span><span class="hljs-number">-22</span>,<span class="hljs-number">104</span>,<span class="hljs-literal">TRUE</span>
AZ123,<span class="hljs-number">2016</span><span class="hljs-number">-01</span><span class="hljs-number">-23</span>,<span class="hljs-number">104</span>,<span class="hljs-literal">TRUE</span>
AZ123,<span class="hljs-number">2016</span><span class="hljs-number">-01</span><span class="hljs-number">-24</span>,<span class="hljs-number">104</span>,<span class="hljs-literal">TRUE</span>
NY229,<span class="hljs-number">2016</span><span class="hljs-number">-01</span><span class="hljs-number">-30</span>,<span class="hljs-number">104</span>,<span class="hljs-literal">TRUE</span>
NY229,<span class="hljs-number">2016</span><span class="hljs-number">-01</span><span class="hljs-number">-31</span>,<span class="hljs-number">104</span>,<span class="hljs-literal">TRUE</span>
NY229,<span class="hljs-number">2016</span><span class="hljs-number">-01</span><span class="hljs-number">-07</span>,<span class="hljs-number">105</span>,<span class="hljs-literal">TRUE</span>
NY229,<span class="hljs-number">2016</span><span class="hljs-number">-01</span><span class="hljs-number">-08</span>,<span class="hljs-number">105</span>,<span class="hljs-literal">TRUE</span>
NY229,<span class="hljs-number">2016</span><span class="hljs-number">-01</span><span class="hljs-number">-09</span>,<span class="hljs-number">105</span>,<span class="hljs-literal">TRUE</span>
NY229,<span class="hljs-number">2016</span><span class="hljs-number">-01</span><span class="hljs-number">-10</span>,<span class="hljs-number">105</span>,<span class="hljs-literal">TRUE</span>
NY229,<span class="hljs-number">2016</span><span class="hljs-number">-01</span><span class="hljs-number">-11</span>,<span class="hljs-number">105</span>,<span class="hljs-literal">TRUE</span>
NY229,<span class="hljs-number">2016</span><span class="hljs-number">-01</span><span class="hljs-number">-30</span>,<span class="hljs-number">105</span>,<span class="hljs-literal">TRUE</span>
NY229,<span class="hljs-number">2016</span><span class="hljs-number">-01</span><span class="hljs-number">-31</span>,<span class="hljs-number">105</span>,<span class="hljs-literal">TRUE</span>
</code></pre><ul>
<li>Build the database. The script <code>hotel.cql</code> contains all commands for creating the keyspace and tables from the previous section.</li>
</ul><pre><code class="wrap sql hljs">SOURCE '/hotel.cql';
</code></pre><div class="alert alert-info">
<p>You can copy the file to the docker container using <code>docker cp</code> as follows:</p>
<pre><code class="shell hljs">docker cp hotel.cql &lt;container-id&gt;:/
</code></pre>
</div><ul>
<li>Switch to the keyspace.</li>
</ul><pre><code class="sql hljs"><span class="hljs-keyword">USE</span> hotel;
</code></pre><ul>
<li>Load data from csv file</li>
</ul><pre><code class="sql hljs">COPY available_rooms_by_hotel_date FROM 'data.csv' <span class="hljs-keyword">WITH</span> HEADER=<span class="hljs-literal">true</span>;
</code></pre><div class="alert alert-info">
<p>You can copy the file to the docker container using <code>docker cp</code> as follows:</p>
<pre><code class="shell hljs">docker cp data.csv &lt;container-id&gt;:/
</code></pre>
</div><ul>
<li>Run queries.</li>
</ul><pre><code class="wrap sql hljs"><span class="hljs-comment">-- Search for hotel rooms for a specific hotel and date range:</span>
<span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> available_rooms_by_hotel_date <span class="hljs-keyword">WHERE</span> hotel_id=<span class="hljs-string">'AZ123'</span> <span class="hljs-keyword">and</span> <span class="hljs-built_in">date</span>&gt;<span class="hljs-string">'2016-01-05'</span> <span class="hljs-keyword">and</span> <span class="hljs-built_in">date</span>&lt;<span class="hljs-string">'2016-01-12'</span>;

<span class="hljs-comment">-- Why doesn't this query work?</span>
<span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> available_rooms_by_hotel_date <span class="hljs-keyword">WHERE</span> hotel_id=<span class="hljs-string">'AZ123'</span> <span class="hljs-keyword">and</span> room_number=<span class="hljs-number">101</span>;
<span class="hljs-comment">-- Append ALLOW FILTERING to let it work</span>

<span class="hljs-comment">-- Look at the table again</span>
<span class="hljs-keyword">DESCRIBE</span> <span class="hljs-keyword">TABLE</span> available_rooms_by_hotel_date;

<span class="hljs-comment">-- We can force it to work, but why is this not a good practice?</span>
<span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> available_rooms_by_hotel_date <span class="hljs-keyword">WHERE</span> <span class="hljs-built_in">date</span>=<span class="hljs-string">'2016-01-25'</span> <span class="hljs-keyword">ALLOW</span> FILTERING;
<span class="hljs-comment">-- You can force the query using the ALLOW FILTERING option; however, this loads the entire partition and negatively impacts performance by causing long READ latencies</span>

<span class="hljs-comment">-- Use the IN clause to test equality with multiple possible values for a column</span>
<span class="hljs-comment">-- Find inventory on two dates a week apart</span>
<span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> available_rooms_by_hotel_date <span class="hljs-keyword">WHERE</span> hotel_id=<span class="hljs-string">'AZ123'</span> <span class="hljs-keyword">AND</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">IN</span> (<span class="hljs-string">'2016-01-05'</span>, <span class="hljs-string">'2016-01-12'</span>);


<span class="hljs-comment">-- Override the default sort order on the table</span>
<span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> available_rooms_by_hotel_date
  <span class="hljs-keyword">WHERE</span> hotel_id=<span class="hljs-string">'AZ123'</span> <span class="hljs-keyword">AND</span> <span class="hljs-built_in">date</span>&gt;<span class="hljs-string">'2016-01-05'</span> <span class="hljs-keyword">AND</span> <span class="hljs-built_in">date</span>&lt;<span class="hljs-string">'2016-01-12'</span>
  <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">DESC</span>;
</code></pre><h1 id="References"><a class="anchor hidden-xs" href="#References" title="References"><i class="fa fa-link"></i></a>References</h1><ul>
<li><a href="https://quickref.me/postgres" target="_blank" rel="noopener">PostgreSQL cheatsheet</a></li>
<li>Yasin N. Silva, Isadora Almeida, and Michell Queiroz. 2016. SQL: From Traditional Databases to Big Data. In Proceedings of the 47th ACM Technical Symposium on Computing Science Education (SIGCSE '16). Association for Computing Machinery, New York, NY, USA, 413–418. <a href="https://doi.org/10.1145/2839509.2844560" target="_blank" rel="noopener">https://doi.org/10.1145/2839509.2844560</a></li>
<li><a href="https://www.postgresqltutorial.com" target="_blank" rel="noopener">Comprehensive PostgreSQL Tutorial</a></li>
<li><a href="https://www.postgresql.org/docs/9.2/app-psql.html" target="_blank" rel="noopener">psql 9.2 Documentation</a></li>
<li><a href="https://cassandra.apache.org/doc/stable/" target="_blank" rel="noopener">Cassandra docs</a></li>
<li><a href="https://www.oreilly.com/library/view/cassandra-the-definitive/9781492097136/?_gl=1*qen58g*_ga*MjA1Njk3NjQxMy4xNzM4NjYwMTM5*_ga_092EL089CH*MTczODY2MDEzOC4xLjEuMTczODY2MDE1Ny40MS4wLjA." target="_blank" rel="noopener">Cassandra, The Definitive Guide. Published by O’Reilly Media, Inc. Copyright © 2020 Jeff Carpenter, Eben Hewitt.</a></li>
<li><a href="https://www.pythian.com/blog/technical-track/cassandra-cql-cheatsheet" target="_blank" rel="noopener">CQLSH cheatsheet</a></li>
<li><a href="https://aiven.io/blog/an-introduction-to-apache-cassandra" target="_blank" rel="noopener">Introduction to Apache Cassandra</a></li>
<li><a href="https://docs.datastax.com/en/cql/hcd/develop/querying/query.html" target="_blank" rel="noopener">Querying in CQL</a></li>
<li><a href="https://docs.citusdata.com/en/v8.1/installation/single_machine_docker.html" target="_blank" rel="noopener">Citus data installation</a></li>
<li><a href="https://docs.citusdata.com/en/v8.1/get_started/tutorial_multi_tenant.html#data-model-and-sample-data" target="_blank" rel="noopener">Citus data getting started</a></li>
<li><a href="https://www.amazon.com/Cassandra-Design-Patterns-Rajanarayanan-Thottuvaikkatumana/dp/178528570X" target="_blank" rel="noopener">Cassandra design patterns</a></li>
</ul></div>
    <div class="ui-toc dropup unselectable hidden-print" style="display:none;">
        <div class="pull-right dropdown">
            <a id="tocLabel" class="ui-toc-label btn btn-default" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false" title="Table of content">
                <i class="fa fa-bars"></i>
            </a>
            <ul id="ui-toc" class="ui-toc-dropdown dropdown-menu" aria-labelledby="tocLabel">
                <div class="toc"><ul class="nav">
<li class=""><a href="#Lab-2---Data-Retrieval-with-SQL-and-CQL" title="Lab 2 - Data Retrieval with SQL and CQL">Lab 2 - Data Retrieval with SQL and CQL</a></li>
<li class=""><a href="#Dataset" title="Dataset">Dataset</a></li>
<li class=""><a href="#Agenda" title="Agenda">Agenda</a></li>
<li class=""><a href="#Prerequisites" title="Prerequisites">Prerequisites</a></li>
<li class=""><a href="#Objectives" title="Objectives">Objectives</a></li>
<li class=""><a href="#Introduction" title="Introduction">Introduction</a></li>
<li class=""><a href="#Dataset-Descripion" title="Dataset Descripion">Dataset Descripion</a></li>
<li class=""><a href="#Access-PostgreSQL-server" title="Access PostgreSQL server">Access PostgreSQL server</a></li>
<li class=""><a href="#PostgreSQL-Meta-commands" title="PostgreSQL Meta-commands">PostgreSQL Meta-commands</a></li>
<li class=""><a href="#Build-the-Database" title="Build the Database">Build the Database</a><ul class="nav">
<li class=""><a href="#Fix-Friends-table" title="Fix Friends table">Fix Friends table</a></li>
</ul>
</li>
<li class=""><a href="#Data-Retrieval-using-SQL" title="Data Retrieval using SQL">Data Retrieval using SQL</a><ul class="nav">
<li class=""><a href="#Data-Retrieval-from-a-single-table" title="Data Retrieval from a single table">Data Retrieval from a single table</a></li>
<li class=""><a href="#Data-Retrieval-from-multiple-tables-Joining-tables" title="Data Retrieval from multiple tables (Joining tables)">Data Retrieval from multiple tables (Joining tables)</a></li>
<li class=""><a href="#Aggregation-and-grouping" title="Aggregation and grouping">Aggregation and grouping</a></li>
<li class=""><a href="#Citus-Data" title="Citus Data">Citus Data</a></li>
</ul>
</li>
<li><a href="#Apache-Cassandra" title="Apache Cassandra">Apache Cassandra</a><ul class="nav">
<li><a href="#Installing-Cassandra" title="Installing Cassandra">Installing Cassandra</a><ul class="nav">
<li><a href="#Single-node-Cassandra-server-installation" title="Single-node Cassandra server installation">Single-node Cassandra server installation</a></li>
<li><a href="#Multi-node-Cassandra-cluster" title="Multi-node Cassandra cluster">Multi-node Cassandra cluster</a></li>
</ul>
</li>
<li><a href="#Cassandra-data-model" title="Cassandra data model">Cassandra data model</a></li>
<li><a href="#CQL" title="CQL">CQL</a></li>
<li><a href="#CQLSH" title="CQLSH">CQLSH</a><ul class="nav">
<li><a href="#Some-cqlsh-commands" title="Some cqlsh commands">Some cqlsh commands</a></li>
<li><a href="#Some-CRUD-operations" title="Some CRUD operations">Some CRUD operations</a></li>
<li><a href="#Collections-in-CQL" title="Collections in CQL">Collections in CQL</a></li>
<li><a href="#Conditional-queries" title="Conditional queries">Conditional queries</a></li>
<li><a href="#Clustering-columns" title="Clustering columns">Clustering columns</a></li>
<li><a href="#Group-by-clause" title="Group by clause">Group by clause</a></li>
</ul>
</li>
<li><a href="#Example-on-Cassandra-database" title="Example on Cassandra database">Example on Cassandra database</a><ul class="nav">
<li><a href="#Define-application-queries" title="Define application queries">Define application queries</a></li>
<li><a href="#Define-logical-data-model" title="Define logical data model">Define logical data model</a></li>
<li><a href="#Physical-data-modeling" title="Physical data modeling">Physical data modeling</a></li>
<li><a href="#Create-the-database-objects" title="Create the database objects">Create the database objects</a></li>
<li><a href="#Populate-data-from-csv-file" title="Populate data from csv file">Populate data from csv file</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#References" title="References">References</a></li>
</ul>
</div><div class="toc-menu" style="">
    <a class="expand-toggle expand-all" href="#">Expand all</a>
    <a class="expand-toggle collapse-all" href="#" style="display: none;">Collapse all</a>
    <a class="back-to-top" href="#">Back to top</a>
    <a class="go-to-bottom" href="#">Go to bottom</a>
</div>
            </ul>
        </div>
    </div>
    <div id="ui-toc-affix" class="ui-affix-toc ui-toc-dropdown unselectable hidden-print" data-spy="affix" style="top:17px;display:none;"  >
        <div class="toc"><ul class="nav">
<li class=""><a href="#Lab-2---Data-Retrieval-with-SQL-and-CQL" title="Lab 2 - Data Retrieval with SQL and CQL">Lab 2 - Data Retrieval with SQL and CQL</a></li>
<li class=""><a href="#Dataset" title="Dataset">Dataset</a></li>
<li class=""><a href="#Agenda" title="Agenda">Agenda</a></li>
<li class=""><a href="#Prerequisites" title="Prerequisites">Prerequisites</a></li>
<li class=""><a href="#Objectives" title="Objectives">Objectives</a></li>
<li class=""><a href="#Introduction" title="Introduction">Introduction</a></li>
<li class=""><a href="#Dataset-Descripion" title="Dataset Descripion">Dataset Descripion</a></li>
<li class=""><a href="#Access-PostgreSQL-server" title="Access PostgreSQL server">Access PostgreSQL server</a></li>
<li class=""><a href="#PostgreSQL-Meta-commands" title="PostgreSQL Meta-commands">PostgreSQL Meta-commands</a></li>
<li class=""><a href="#Build-the-Database" title="Build the Database">Build the Database</a><ul class="nav">
<li class=""><a href="#Fix-Friends-table" title="Fix Friends table">Fix Friends table</a></li>
</ul>
</li>
<li class=""><a href="#Data-Retrieval-using-SQL" title="Data Retrieval using SQL">Data Retrieval using SQL</a><ul class="nav">
<li class=""><a href="#Data-Retrieval-from-a-single-table" title="Data Retrieval from a single table">Data Retrieval from a single table</a></li>
<li class=""><a href="#Data-Retrieval-from-multiple-tables-Joining-tables" title="Data Retrieval from multiple tables (Joining tables)">Data Retrieval from multiple tables (Joining tables)</a></li>
<li class=""><a href="#Aggregation-and-grouping" title="Aggregation and grouping">Aggregation and grouping</a></li>
<li class=""><a href="#Citus-Data" title="Citus Data">Citus Data</a></li>
</ul>
</li>
<li><a href="#Apache-Cassandra" title="Apache Cassandra">Apache Cassandra</a><ul class="nav">
<li><a href="#Installing-Cassandra" title="Installing Cassandra">Installing Cassandra</a><ul class="nav">
<li><a href="#Single-node-Cassandra-server-installation" title="Single-node Cassandra server installation">Single-node Cassandra server installation</a></li>
<li><a href="#Multi-node-Cassandra-cluster" title="Multi-node Cassandra cluster">Multi-node Cassandra cluster</a></li>
</ul>
</li>
<li><a href="#Cassandra-data-model" title="Cassandra data model">Cassandra data model</a></li>
<li><a href="#CQL" title="CQL">CQL</a></li>
<li><a href="#CQLSH" title="CQLSH">CQLSH</a><ul class="nav">
<li><a href="#Some-cqlsh-commands" title="Some cqlsh commands">Some cqlsh commands</a></li>
<li><a href="#Some-CRUD-operations" title="Some CRUD operations">Some CRUD operations</a></li>
<li><a href="#Collections-in-CQL" title="Collections in CQL">Collections in CQL</a></li>
<li><a href="#Conditional-queries" title="Conditional queries">Conditional queries</a></li>
<li><a href="#Clustering-columns" title="Clustering columns">Clustering columns</a></li>
<li><a href="#Group-by-clause" title="Group by clause">Group by clause</a></li>
</ul>
</li>
<li><a href="#Example-on-Cassandra-database" title="Example on Cassandra database">Example on Cassandra database</a><ul class="nav">
<li><a href="#Define-application-queries" title="Define application queries">Define application queries</a></li>
<li><a href="#Define-logical-data-model" title="Define logical data model">Define logical data model</a></li>
<li><a href="#Physical-data-modeling" title="Physical data modeling">Physical data modeling</a></li>
<li><a href="#Create-the-database-objects" title="Create the database objects">Create the database objects</a></li>
<li><a href="#Populate-data-from-csv-file" title="Populate data from csv file">Populate data from csv file</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#References" title="References">References</a></li>
</ul>
</div><div class="toc-menu" style="">
    <a class="expand-toggle expand-all" href="#">Expand all</a>
    <a class="expand-toggle collapse-all" href="#" style="display: none;">Collapse all</a>
    <a class="back-to-top" href="#">Back to top</a>
    <a class="go-to-bottom" href="#">Go to bottom</a>
</div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.0/js/bootstrap.min.js" integrity="sha256-kJrlY+s09+QoWjpkOrXXwhxeaoDz9FW5SaxF8I0DibQ=" crossorigin="anonymous" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gist-embed/2.6.0/gist-embed.min.js" integrity="sha256-KyF2D6xPIJUW5sUDSs93vWyZm+1RzIpKCexxElmxl8g=" crossorigin="anonymous" defer></script>
    <script>
        var markdown = $(".markdown-body");
        //smooth all hash trigger scrolling
        function smoothHashScroll() {
            var hashElements = $("a[href^='#']").toArray();
            for (var i = 0; i < hashElements.length; i++) {
                var element = hashElements[i];
                var $element = $(element);
                var hash = element.hash;
                if (hash) {
                    $element.on('click', function (e) {
                        // store hash
                        var hash = this.hash;
                        if ($(hash).length <= 0) return;
                        // prevent default anchor click behavior
                        e.preventDefault();
                        // animate
                        $('body, html').stop(true, true).animate({
                            scrollTop: $(hash).offset().top
                        }, 100, "linear", function () {
                            // when done, add hash to url
                            // (default click behaviour)
                            window.location.hash = hash;
                        });
                    });
                }
            }
        }

        smoothHashScroll();
        var toc = $('.ui-toc');
        var tocAffix = $('.ui-affix-toc');
        var tocDropdown = $('.ui-toc-dropdown');
        //toc
        tocDropdown.click(function (e) {
            e.stopPropagation();
        });

        var enoughForAffixToc = true;

        function generateScrollspy() {
            $(document.body).scrollspy({
                target: ''
            });
            $(document.body).scrollspy('refresh');
            if (enoughForAffixToc) {
                toc.hide();
                tocAffix.show();
            } else {
                tocAffix.hide();
                toc.show();
            }
            $(document.body).scroll();
        }

        function windowResize() {
            //toc right
            var paddingRight = parseFloat(markdown.css('padding-right'));
            var right = ($(window).width() - (markdown.offset().left + markdown.outerWidth() - paddingRight));
            toc.css('right', right + 'px');
            //affix toc left
            var newbool;
            var rightMargin = (markdown.parent().outerWidth() - markdown.outerWidth()) / 2;
            //for ipad or wider device
            if (rightMargin >= 133) {
                newbool = true;
                var affixLeftMargin = (tocAffix.outerWidth() - tocAffix.width()) / 2;
                var left = markdown.offset().left + markdown.outerWidth() - affixLeftMargin;
                tocAffix.css('left', left + 'px');
            } else {
                newbool = false;
            }
            if (newbool != enoughForAffixToc) {
                enoughForAffixToc = newbool;
                generateScrollspy();
            }
        }
        $(window).resize(function () {
            windowResize();
        });
        $(document).ready(function () {
            windowResize();
            generateScrollspy();
        });

        //remove hash
        function removeHash() {
            window.location.hash = '';
        }

        var backtotop = $('.back-to-top');
        var gotobottom = $('.go-to-bottom');

        backtotop.click(function (e) {
            e.preventDefault();
            e.stopPropagation();
            if (scrollToTop)
                scrollToTop();
            removeHash();
        });
        gotobottom.click(function (e) {
            e.preventDefault();
            e.stopPropagation();
            if (scrollToBottom)
                scrollToBottom();
            removeHash();
        });

        var toggle = $('.expand-toggle');
        var tocExpand = false;

        checkExpandToggle();
        toggle.click(function (e) {
            e.preventDefault();
            e.stopPropagation();
            tocExpand = !tocExpand;
            checkExpandToggle();
        })

        function checkExpandToggle () {
            var toc = $('.ui-toc-dropdown .toc');
            var toggle = $('.expand-toggle');
            if (!tocExpand) {
                toc.removeClass('expand');
                toggle.text('Expand all');
            } else {
                toc.addClass('expand');
                toggle.text('Collapse all');
            }
        }

        function scrollToTop() {
            $('body, html').stop(true, true).animate({
                scrollTop: 0
            }, 100, "linear");
        }

        function scrollToBottom() {
            $('body, html').stop(true, true).animate({
                scrollTop: $(document.body)[0].scrollHeight
            }, 100, "linear");
        }
    </script>
</body>

</html>
